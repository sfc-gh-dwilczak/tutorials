<!DOCTYPE html><html lang="en" class="no-js"><head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../external/">
      
      
        <link rel="next" href="../iceberg/">
      
      
        
      
      
      <link rel="icon" href="../../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.21+insiders-4.53.17">
    
    
      
        <title>Fivetran Data Lake - Daniel Wilczak - Tutorials</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/main.7d528353.min.css">
      
        
        <link rel="stylesheet" href="../../../assets/stylesheets/palette.ab4e12ef.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&amp;display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      
  


  
  

<script id="__analytics">function __md_analytics(){function e(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],e("js",new Date),e("config","G-2VSMCC57YV"),document.addEventListener("DOMContentLoaded",(function(){document.forms.search&&document.forms.search.query.addEventListener("blur",(function(){this.value&&e("event","search",{search_term:this.value})}));document$.subscribe((function(){var t=document.forms.feedback;if(void 0!==t)for(var a of t.querySelectorAll("[type=submit]"))a.addEventListener("click",(function(a){a.preventDefault();var n=document.location.pathname,d=this.getAttribute("data-md-value");e("event","feedback",{page:n,data:d}),t.firstElementChild.disabled=!0;var r=t.querySelector(".md-feedback__note [data-md-value='"+d+"']");r&&(r.hidden=!1)})),t.hidden=!1})),location$.subscribe((function(t){e("config","G-2VSMCC57YV",{page_path:t.pathname})}))}));var t=document.createElement("script");t.async=!0,t.src="https://www.googletagmanager.com/gtag/js?id=G-2VSMCC57YV",document.getElementById("__analytics").insertAdjacentElement("afterEnd",t)}</script>
  
    <script>"undefined"!=typeof __md_analytics&&__md_analytics()</script>
  

    
    
  <link href="../../../assets/stylesheets/glightbox.min.css" rel="stylesheet"><script src="../../../assets/javascripts/glightbox.min.js"></script><style id="glightbox-style">
            html.glightbox-open { overflow: initial; height: 100%; }
            .gslide-title { margin-top: 0px; user-select: text; }
            .gslide-desc { color: #666; user-select: text; }
            .gslide-image img { background: white; }
            .gscrollbar-fixer { padding-right: 15px; }
            .gdesc-inner { font-size: 0.75rem; }
            body[data-md-color-scheme="slate"] .gdesc-inner { background: var(--md-default-bg-color); }
            body[data-md-color-scheme="slate"] .gslide-title { color: var(--md-default-fg-color); }
            body[data-md-color-scheme="slate"] .gslide-desc { color: var(--md-default-fg-color); }
        </style></head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="slate" data-md-color-primary="blue" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#gcp-fivetran-lata-lake" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../.." title="Daniel Wilczak - Tutorials" class="md-header__button md-logo" aria-label="Daniel Wilczak - Tutorials" data-md-component="logo">
      
  <img src="../../../assets/logo.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"></path></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Daniel Wilczak - Tutorials
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
                Fivetran Data Lake
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="blue" data-md-color-accent="indigo" aria-label="Switch to dark mode" type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"></path></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="blue" data-md-color-accent="indigo" aria-label="Switch to light mode" type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12s-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"></path></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"></path></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"></path></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"></path></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"></path></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/sfc-gh-dwilczak/tutorials/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.0.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"></path></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../.." title="Daniel Wilczak - Tutorials" class="md-nav__button md-logo" aria-label="Daniel Wilczak - Tutorials" data-md-component="logo">
      
  <img src="../../../assets/logo.png" alt="logo">

    </a>
    Daniel Wilczak - Tutorials
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/sfc-gh-dwilczak/tutorials/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.0.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"></path></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    <span class="md-typeset">
      Introduction
    </span>
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="#" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Clouds
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3">
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
     AWS
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            
  
     AWS
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../aws/s3/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
      S3
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../aws/kinesis/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
      Kinesis
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4">
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
     Azure
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            
  
     Azure
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../azure/storage/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
      Blob / Storage
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../azure/sso/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
      Active Directory / SSO
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../azure/scim/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
      SCIM
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" checked>
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
     Google Cloud
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            
  
     Google Cloud
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../storage/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
      Cloud Storage
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../external/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
      External Tables
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    
  
      Fivetran Data Lake
  

    
  </span>
  
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    
  
      Fivetran Data Lake
  

    
  </span>
  
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#video" class="md-nav__link">
    <span class="md-ellipsis">
      
        <span class="md-typeset">
          Video
        </span>
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#requirements" class="md-nav__link">
    <span class="md-ellipsis">
      
        <span class="md-typeset">
          Requirements
        </span>
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#setup" class="md-nav__link">
    <span class="md-ellipsis">
      
        <span class="md-typeset">
          Setup  <span class="twemoji"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path d="M7.22 6.5a.72.72 0 1 1-1.44 0 .72.72 0 0 1 1.44 0"></path><path d="M8 16A8 8 0 1 1 8 0a8 8 0 0 1 0 16M4 5v3.38c.001.397.159.778.44 1.059l3.211 3.213a1.2 1.2 0 0 0 1.698 0l3.303-3.303a1.2 1.2 0 0 0 0-1.698L9.439 4.44A1.5 1.5 0 0 0 8.379 4H5a1 1 0 0 0-1 1"></path></svg></span>
        </span>
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Setup">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#google-cloud" class="md-nav__link">
    <span class="md-ellipsis">
      
        <span class="md-typeset">
          Google Cloud
        </span>
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Google Cloud">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#create-project" class="md-nav__link">
    <span class="md-ellipsis">
      
        <span class="md-typeset">
          Create project
        </span>
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#create-storage-bucket" class="md-nav__link">
    <span class="md-ellipsis">
      
        <span class="md-typeset">
          Create storage bucket
        </span>
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fivetran" class="md-nav__link">
    <span class="md-ellipsis">
      
        <span class="md-typeset">
          Fivetran
        </span>
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Fivetran">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#authorize-fivetran-in-gcp" class="md-nav__link">
    <span class="md-ellipsis">
      
        <span class="md-typeset">
          Authorize Fivetran in GCP
        </span>
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#snowflake" class="md-nav__link">
    <span class="md-ellipsis">
      
        <span class="md-typeset">
          Snowflake
        </span>
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Snowflake">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#grant-access-in-gcp" class="md-nav__link">
    <span class="md-ellipsis">
      
        <span class="md-typeset">
          Grant access in GCP
        </span>
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#load-source-data" class="md-nav__link">
    <span class="md-ellipsis">
      
        <span class="md-typeset">
          Load source data
        </span>
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#create-table" class="md-nav__link">
    <span class="md-ellipsis">
      
        <span class="md-typeset">
          Create - Table  <span class="twemoji"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path d="M7.22 6.5a.72.72 0 1 1-1.44 0 .72.72 0 0 1 1.44 0"></path><path d="M8 16A8 8 0 1 1 8 0a8 8 0 0 1 0 16M4 5v3.38c.001.397.159.778.44 1.059l3.211 3.213a1.2 1.2 0 0 0 1.698 0l3.303-3.303a1.2 1.2 0 0 0 0-1.698L9.439 4.44A1.5 1.5 0 0 0 8.379 4H5a1 1 0 0 0-1 1"></path></svg></span>
        </span>
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#automate-table-creation" class="md-nav__link">
    <span class="md-ellipsis">
      
        <span class="md-typeset">
          Automate - Table Creation  <span class="twemoji"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path d="M7.22 6.5a.72.72 0 1 1-1.44 0 .72.72 0 0 1 1.44 0"></path><path d="M8 16A8 8 0 1 1 8 0a8 8 0 0 1 0 16M4 5v3.38c.001.397.159.778.44 1.059l3.211 3.213a1.2 1.2 0 0 0 1.698 0l3.303-3.303a1.2 1.2 0 0 0 0-1.698L9.439 4.44A1.5 1.5 0 0 0 8.379 4H5a1 1 0 0 0-1 1"></path></svg></span>
        </span>
      
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../iceberg/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
      Iceberg
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../sso/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
      SSO
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="#" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Configurations
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7">
        
          
          <label class="md-nav__link" for="__nav_7" id="__nav_7_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
     Account
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7">
            <span class="md-nav__icon md-icon"></span>
            
  
     Account
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../configurations/account/add/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
      Add account to Org
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../configurations/account/service_level/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
      Change Service Level
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../configurations/account/name/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
      Org / Account name
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../configurations/account/replication/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
      Replication
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../configurations/account/support/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
      Support Ticket
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_8">
        
          
          <label class="md-nav__link" for="__nav_8" id="__nav_8_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
     Security
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_8_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_8">
            <span class="md-nav__icon md-icon"></span>
            
  
     Security
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../configurations/security/key_pair/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
      Key Pair Authentication
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../configurations/security/python/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
      Python with Key Pair
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../configurations/security/network_policy/user/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
      Network Policy - User
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="#" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Data Sharing
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../sharing/direct/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
     Direct
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../sharing/listing/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
     Listings
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="#" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Data Science / ML
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../science/analyst/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
     Cortex Analyst
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_14">
        
          
          <label class="md-nav__link" for="__nav_14" id="__nav_14_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
     Models
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_14_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_14">
            <span class="md-nav__icon md-icon"></span>
            
  
     Models
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../science/models/registry/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
      Registry
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_15">
        
          
          <label class="md-nav__link" for="__nav_15" id="__nav_15_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
     Notebooks
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_15_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_15">
            <span class="md-nav__icon md-icon"></span>
            
  
     Notebooks
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../science/notebooks/containers/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
      Intro to Containerized
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../science/notebooks/jupyter/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
      Intro to Local Jupyter
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="#" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Engineering
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_17">
        
          
          <label class="md-nav__link" for="__nav_17" id="__nav_17_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
     API's
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_17_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_17">
            <span class="md-nav__icon md-icon"></span>
            
  
     API's
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../engineering/api/introduction/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
      Intoduction via Notebook
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../engineering/api/chatgpt/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
      Chatgpt
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_18">
        
          
          <label class="md-nav__link" for="__nav_18" id="__nav_18_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
     Documents
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_18_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_18">
            <span class="md-nav__icon md-icon"></span>
            
  
     Documents
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../engineering/documents/ai/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
      Document AI
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_19">
        
          
          <label class="md-nav__link" for="__nav_19" id="__nav_19_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
     Tasks
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_19_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_19">
            <span class="md-nav__icon md-icon"></span>
            
  
     Tasks
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../engineering/tasks/lineage/intro/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
      Lineage
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_20">
        
          
          <label class="md-nav__link" for="__nav_20" id="__nav_20_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
     SFTP
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_20_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_20">
            <span class="md-nav__icon md-icon"></span>
            
  
     SFTP
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../engineering/sftp/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
      Via Notebook
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="#" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Openflow
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_22">
        
          
          <label class="md-nav__link" for="__nav_22" id="__nav_22_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
     Deployment
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_22_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_22">
            <span class="md-nav__icon md-icon"></span>
            
  
     Deployment
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../engineering/openflow/deployments/spcs/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
      SPCS
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../engineering/openflow/deployments/byoc_snowflake_vpc/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
      BYOC with Snowflake VPC
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_23">
        
          
          <label class="md-nav__link" for="__nav_23" id="__nav_23_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
     Connectors
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_23_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_23">
            <span class="md-nav__icon md-icon"></span>
            
  
     Connectors
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../engineering/openflow/connectors/google_sheets/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
      Google Sheet
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="#" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Tools
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../tools/dbt/setup/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
     DBT
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_26">
        
          
          <label class="md-nav__link" for="__nav_26" id="__nav_26_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
     Fivetran
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_26_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_26">
            <span class="md-nav__icon md-icon"></span>
            
  
     Fivetran
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../tools/fivetran/introduction/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
      Introduction
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_26_2">
        
          
          <label class="md-nav__link" for="__nav_26_2" id="__nav_26_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
      Sources
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_26_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_26_2">
            <span class="md-nav__icon md-icon"></span>
            
  
      Sources
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../tools/fivetran/sources/google_analytics/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
       Google Analytics
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../tools/git/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
     Git
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_28">
        
          
          <label class="md-nav__link" for="__nav_28" id="__nav_28_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
     Tableau
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_28_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_28">
            <span class="md-nav__icon md-icon"></span>
            
  
     Tableau
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../tools/tableau/key_pair/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
      Key Pair
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../tools/tableau/oauth_snowflake/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
      OAuth - Snowflake
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../tools/zapier/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
     Zapier
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="#" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Apps
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_31">
        
          
          <label class="md-nav__link" for="__nav_31" id="__nav_31_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
     Container Services
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_31_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_31">
            <span class="md-nav__icon md-icon"></span>
            
  
     Container Services
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../apps/container/introduction/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
      Introduction
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../apps/container/streamlit/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
      Streamlit
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_32">
        
          
          <label class="md-nav__link" for="__nav_32" id="__nav_32_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
     Native App
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_32_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_32">
            <span class="md-nav__icon md-icon"></span>
            
  
     Native App
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../apps/native/containers/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
      Container Services
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../apps/native/traditional/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
      Traditional
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#video" class="md-nav__link">
    <span class="md-ellipsis">
      
        <span class="md-typeset">
          Video
        </span>
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#requirements" class="md-nav__link">
    <span class="md-ellipsis">
      
        <span class="md-typeset">
          Requirements
        </span>
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#setup" class="md-nav__link">
    <span class="md-ellipsis">
      
        <span class="md-typeset">
          Setup  <span class="twemoji"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path d="M7.22 6.5a.72.72 0 1 1-1.44 0 .72.72 0 0 1 1.44 0"></path><path d="M8 16A8 8 0 1 1 8 0a8 8 0 0 1 0 16M4 5v3.38c.001.397.159.778.44 1.059l3.211 3.213a1.2 1.2 0 0 0 1.698 0l3.303-3.303a1.2 1.2 0 0 0 0-1.698L9.439 4.44A1.5 1.5 0 0 0 8.379 4H5a1 1 0 0 0-1 1"></path></svg></span>
        </span>
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Setup">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#google-cloud" class="md-nav__link">
    <span class="md-ellipsis">
      
        <span class="md-typeset">
          Google Cloud
        </span>
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Google Cloud">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#create-project" class="md-nav__link">
    <span class="md-ellipsis">
      
        <span class="md-typeset">
          Create project
        </span>
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#create-storage-bucket" class="md-nav__link">
    <span class="md-ellipsis">
      
        <span class="md-typeset">
          Create storage bucket
        </span>
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fivetran" class="md-nav__link">
    <span class="md-ellipsis">
      
        <span class="md-typeset">
          Fivetran
        </span>
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Fivetran">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#authorize-fivetran-in-gcp" class="md-nav__link">
    <span class="md-ellipsis">
      
        <span class="md-typeset">
          Authorize Fivetran in GCP
        </span>
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#snowflake" class="md-nav__link">
    <span class="md-ellipsis">
      
        <span class="md-typeset">
          Snowflake
        </span>
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Snowflake">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#grant-access-in-gcp" class="md-nav__link">
    <span class="md-ellipsis">
      
        <span class="md-typeset">
          Grant access in GCP
        </span>
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#load-source-data" class="md-nav__link">
    <span class="md-ellipsis">
      
        <span class="md-typeset">
          Load source data
        </span>
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#create-table" class="md-nav__link">
    <span class="md-ellipsis">
      
        <span class="md-typeset">
          Create - Table  <span class="twemoji"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path d="M7.22 6.5a.72.72 0 1 1-1.44 0 .72.72 0 0 1 1.44 0"></path><path d="M8 16A8 8 0 1 1 8 0a8 8 0 0 1 0 16M4 5v3.38c.001.397.159.778.44 1.059l3.211 3.213a1.2 1.2 0 0 0 1.698 0l3.303-3.303a1.2 1.2 0 0 0 0-1.698L9.439 4.44A1.5 1.5 0 0 0 8.379 4H5a1 1 0 0 0-1 1"></path></svg></span>
        </span>
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#automate-table-creation" class="md-nav__link">
    <span class="md-ellipsis">
      
        <span class="md-typeset">
          Automate - Table Creation  <span class="twemoji"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path d="M7.22 6.5a.72.72 0 1 1-1.44 0 .72.72 0 0 1 1.44 0"></path><path d="M8 16A8 8 0 1 1 8 0a8 8 0 0 1 0 16M4 5v3.38c.001.397.159.778.44 1.059l3.211 3.213a1.2 1.2 0 0 0 1.698 0l3.303-3.303a1.2 1.2 0 0 0 0-1.698L9.439 4.44A1.5 1.5 0 0 0 8.379 4H5a1 1 0 0 0-1 1"></path></svg></span>
        </span>
      
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              
              <article class="md-content__inner md-typeset">
                
                  


  
    <a href="https://github.com/sfc-gh-dwilczak/tutorials/edit/main/docs/clouds/google/fivetran/index.md" title="Edit this page" class="md-content__button md-icon" rel="edit">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M10 20H6V4h7v5h5v3.1l2-2V8l-6-6H6c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h4zm10.2-7c.1 0 .3.1.4.2l1.3 1.3c.2.2.2.6 0 .8l-1 1-2.1-2.1 1-1c.1-.1.2-.2.4-.2m0 3.9L14.1 23H12v-2.1l6.1-6.1z"></path></svg>
    </a>
  
  
    
      
    
    <a href="https://github.com/sfc-gh-dwilczak/tutorials/raw/main/docs/clouds/google/fivetran/index.md" title="View source of this page" class="md-content__button md-icon">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 18c.56 0 1 .44 1 1s-.44 1-1 1-1-.44-1-1 .44-1 1-1m0-3c-2.73 0-5.06 1.66-6 4 .94 2.34 3.27 4 6 4s5.06-1.66 6-4c-.94-2.34-3.27-4-6-4m0 6.5a2.5 2.5 0 0 1-2.5-2.5 2.5 2.5 0 0 1 2.5-2.5 2.5 2.5 0 0 1 2.5 2.5 2.5 2.5 0 0 1-2.5 2.5M9.27 20H6V4h7v5h5v4.07c.7.08 1.36.25 2 .49V8l-6-6H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h4.5a8.2 8.2 0 0 1-1.23-2"></path></svg>
    </a>
  


<h1 id="gcp-fivetran-lata-lake">GCP / Fivetran - Lata Lake</h1>
<p>Goal of this tutorial is to setup and integration with Fivetran, GCP and Snowflake to allow fivetran to load iceberg data into a GCP datalake and then integrate Snowflake to be the query engine on that data.</p>
<h2 id="video">Video</h2>
<p>Video still in development.</p>
<h2 id="requirements">Requirements</h2>
<ul>
<li>Snowflake account, you can use a <a href="https://signup.snowflake.com/">free trial</a>. We also assume no complex security needs.</li>
<li>Google cloud account, you can setup a <a href="https://cloud.google.com/">free account</a> to get started.</li>
<li>Fivetran account by signing up for a <a href="https://fivetran.com/signup">free trial</a>.</li>
</ul>
<h2 id="setup">Setup  <span class="twemoji"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path d="M7.22 6.5a.72.72 0 1 1-1.44 0 .72.72 0 0 1 1.44 0"></path><path d="M8 16A8 8 0 1 1 8 0a8 8 0 0 1 0 16M4 5v3.38c.001.397.159.778.44 1.059l3.211 3.213a1.2 1.2 0 0 0 1.698 0l3.303-3.303a1.2 1.2 0 0 0 0-1.698L9.439 4.44A1.5 1.5 0 0 0 8.379 4H5a1 1 0 0 0-1 1"></path></svg></span></h2>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Your GCP bucket and Snowflake acount have to be in the same region to be able to manage iceberg tables.</p>
</div>
<p>Lets start by setting up our Google Cloud Storage bucket. After that we'll connect fivetran to it and finish it off with the Snowflake integration to the Fivtran hosted Polaris Catalog.</p>
<h3 id="google-cloud">Google Cloud</h3>
<p>Sign into your google account. </p>
<h4 id="create-project">Create project</h4>
<p>If you don't have a project, start by selecting/creating a project.
<a class="glightbox" data-type="image" data-width="auto" data-height="auto" href="images/01.png" data-desc-position="bottom"><img alt="Project" src="images/01.png"></a></p>
<p>Click create project.
<a class="glightbox" data-type="image" data-width="auto" data-height="auto" href="images/02.png" data-desc-position="bottom"><img alt="Create project" src="images/02.png"></a></p>
<p>In our case we'll call the project <code>danielwilczak</code> and select the default <code>no organization</code> for the location.
<a class="glightbox" data-type="image" data-width="auto" data-height="auto" href="images/03.png" data-desc-position="bottom"><img alt="Name project" src="images/03.png"></a></p>
<h4 id="create-storage-bucket">Create storage bucket</h4>
<p>We will select our new project and click <code>cloud storage</code> to create a storage bucket.
<a class="glightbox" data-type="image" data-width="auto" data-height="auto" href="images/04.png" data-desc-position="bottom"><img alt="Select project and cloud storage" src="images/04.png"></a></p>
<p>Click <code>create</code> or <code>create bucket</code>.
<a class="glightbox" data-type="image" data-width="auto" data-height="auto" href="images/05.png" data-desc-position="bottom"><img alt="Click create bucket" src="images/05.png"></a></p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Your GCP bucket and Snowflake acount have to be in the same region to be able to manage iceberg tables.</p>
</div>
<p>I'm going to name the bucket <code>danielwilczak</code> as well. Copy this name, we will use it later. We'll also want to make sure the region is the same as our Snowflake account.
<a class="glightbox" data-type="image" data-width="auto" data-height="auto" href="images/06.png" data-desc-position="bottom"><img alt="UPDATE" src="images/06.png"></a></p>
<p>Lets now select our new bucket and add a folder.
<a class="glightbox" data-type="image" data-width="auto" data-height="auto" href="images/07.png" data-desc-position="bottom"><img alt="UPDATE" src="images/07.png"></a></p>
<p>Click create folder.
<a class="glightbox" data-type="image" data-width="auto" data-height="auto" href="images/08.png" data-desc-position="bottom"><img alt="UPDATE" src="images/08.png"></a></p>
<p>Give it a name, I've named mine fivetran because that is who is loading the data.
<a class="glightbox" data-type="image" data-width="auto" data-height="auto" href="images/09.png" data-desc-position="bottom"><img alt="UPDATE" src="images/09.png"></a></p>
<p>You can now see we have our folder. Let's move to setting up Fivetran to load data into our folder.
<a class="glightbox" data-type="image" data-width="auto" data-height="auto" href="images/10.png" data-desc-position="bottom"><img alt="UPDATE" src="images/10.png"></a></p>
<h3 id="fivetran">Fivetran</h3>
<p>Let's now move to connecting fivetran to our bucket. To start let's add our bucket as a destination. Click destination in fivetran.
<a class="glightbox" data-type="image" data-width="auto" data-height="auto" href="images/11.png" data-desc-position="bottom"><img alt="UPDATE" src="images/11.png"></a></p>
<p>Select GCP cloud storage as the location.
<a class="glightbox" data-type="image" data-width="auto" data-height="auto" href="images/12.png" data-desc-position="bottom"><img alt="UPDATE" src="images/12.png"></a></p>
<p>Give the destination a name.
<a class="glightbox" data-type="image" data-width="auto" data-height="auto" href="images/13.png" data-desc-position="bottom"><img alt="UPDATE" src="images/13.png"></a></p>
<p>We'll first want to copy our service account URL to give Fivetran permission to use the bucket.
<a class="glightbox" data-type="image" data-width="auto" data-height="auto" href="images/14.png" data-desc-position="bottom"><img alt="UPDATE" src="images/14.png"></a></p>
<h4 id="authorize-fivetran-in-gcp">Authorize Fivetran in GCP</h4>
<p>Let's head back to our bucket and click the check box followed by the permissions button.
<a class="glightbox" data-type="image" data-width="auto" data-height="auto" href="images/15.png" data-desc-position="bottom"><img alt="UPDATE" src="images/15.png"></a></p>
<p>Click add principle.
<a class="glightbox" data-type="image" data-width="auto" data-height="auto" href="images/16.png" data-desc-position="bottom"><img alt="UPDATE" src="images/16.png"></a></p>
<p>Paste our service account URL given by Fivetran and then click select role.
<a class="glightbox" data-type="image" data-width="auto" data-height="auto" href="images/17.png" data-desc-position="bottom"><img alt="UPDATE" src="images/17.png"></a></p>
<p>We'll want to search for "Storage Object Admin" and then click on it in the dropdown.
<a class="glightbox" data-type="image" data-width="auto" data-height="auto" href="images/18.png" data-desc-position="bottom"><img alt="UPDATE" src="images/18.png"></a></p>
<p>Once both are added click "Save".
<a class="glightbox" data-type="image" data-width="auto" data-height="auto" href="images/19.png" data-desc-position="bottom"><img alt="UPDATE" src="images/19.png"></a></p>
<p>Now we can added our bucket name, folder and click save and test.
<a class="glightbox" data-type="image" data-width="auto" data-height="auto" href="images/20.png" data-desc-position="bottom"><img alt="UPDATE" src="images/20.png"></a></p>
<p>Once tested your destination is ready to use. Let's view the destination.
<a class="glightbox" data-type="image" data-width="auto" data-height="auto" href="images/21.png" data-desc-position="bottom"><img alt="UPDATE" src="images/21.png"></a></p>
<h4 id="snowflake">Snowflake</h4>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Currently you must grab the catalog code when the destination is created otherwise the key will be hidden '<strong><em>*</em></strong>'. Fivetran is working on fixing this issue.</p>
</div>
<p>Now that our data is loaded into our GCP bucket let's connect Snowflake to it using Fivetrans hosted Polaris catalog. Let's start by going back into our GCP destination in Fivetran to copy some Snowflake code.
<a class="glightbox" data-type="image" data-width="auto" data-height="auto" href="images/24.png" data-desc-position="bottom"><img alt="UPDATE" src="images/24.png"></a></p>
<p>Once in the destination, on the top navigation bar, select "Catalog Integration", select Snowflake and then copy the sql code. We will use this in Snowflake next.
<a class="glightbox" data-type="image" data-width="auto" data-height="auto" href="images/25.png" data-desc-position="bottom"><img alt="UPDATE" src="images/25.png"></a></p>
<p>Let's head into Snowflake and add the code from fivetran and the line below. This will allow us to see the tables that are managed by the catalog.</p>
<div class="tabbed-set tabbed-alternate" data-tabs="1:3"><input checked="checked" id="__tabbed_1_1" name="__tabbed_1" type="radio"><input id="__tabbed_1_2" name="__tabbed_1" type="radio"><input id="__tabbed_1_3" name="__tabbed_1" type="radio"><div class="tabbed-labels"><label for="__tabbed_1_1"><span class="twemoji"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path d="M16 13.25A1.75 1.75 0 0 1 14.25 15H1.75A1.75 1.75 0 0 1 0 13.25V2.75C0 1.784.784 1 1.75 1h12.5c.966 0 1.75.784 1.75 1.75ZM1.75 2.5a.25.25 0 0 0-.25.25v10.5c0 .138.112.25.25.25h.94l.03-.03 6.077-6.078a1.75 1.75 0 0 1 2.412-.06L14.5 10.31V2.75a.25.25 0 0 0-.25-.25Zm12.5 11a.25.25 0 0 0 .25-.25v-.917l-4.298-3.889a.25.25 0 0 0-.344.009L4.81 13.5ZM7 6a2 2 0 1 1-3.999.001A2 2 0 0 1 7 6M5.5 6a.5.5 0 1 0-1 0 .5.5 0 0 0 1 0"></path></svg></span> Template</label><label for="__tabbed_1_2"><span class="twemoji"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path d="M16 13.25A1.75 1.75 0 0 1 14.25 15H1.75A1.75 1.75 0 0 1 0 13.25V2.75C0 1.784.784 1 1.75 1h12.5c.966 0 1.75.784 1.75 1.75ZM1.75 2.5a.25.25 0 0 0-.25.25v10.5c0 .138.112.25.25.25h.94l.03-.03 6.077-6.078a1.75 1.75 0 0 1 2.412-.06L14.5 10.31V2.75a.25.25 0 0 0-.25-.25Zm12.5 11a.25.25 0 0 0 .25-.25v-.917l-4.298-3.889a.25.25 0 0 0-.344.009L4.81 13.5ZM7 6a2 2 0 1 1-3.999.001A2 2 0 0 1 7 6M5.5 6a.5.5 0 1 0-1 0 .5.5 0 0 0 1 0"></path></svg></span> Example</label><label for="__tabbed_1_3"><span class="twemoji"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path d="M16 13.25A1.75 1.75 0 0 1 14.25 15H1.75A1.75 1.75 0 0 1 0 13.25V2.75C0 1.784.784 1 1.75 1h12.5c.966 0 1.75.784 1.75 1.75ZM1.75 2.5a.25.25 0 0 0-.25.25v10.5c0 .138.112.25.25.25h.94l.03-.03 6.077-6.078a1.75 1.75 0 0 1 2.412-.06L14.5 10.31V2.75a.25.25 0 0 0-.25-.25Zm12.5 11a.25.25 0 0 0 .25-.25v-.917l-4.298-3.889a.25.25 0 0 0-.344.009L4.81 13.5ZM7 6a2 2 0 1 1-3.999.001A2 2 0 0 1 7 6M5.5 6a.5.5 0 1 0-1 0 .5.5 0 0 0 1 0"></path></svg></span> Template</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-1">1</a></span>
<span class="normal"><a href="#__codelineno-0-2">2</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1"></a><span class="c1">-- To see the tables in the catalog</span>
<a id="__codelineno-0-2" name="__codelineno-0-2"></a><span class="k">select</span><span class="w"> </span><span class="k">system</span><span class="err">$</span><span class="n">list_iceberg_tables_from_catalog</span><span class="p">(</span><span class="s1">'&lt;Catalog Name&gt;'</span><span class="p">,</span><span class="w"> </span><span class="s1">''</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">);</span>
</code></pre></div></td></tr></tbody></table></div>
</div>
<div class="tabbed-block">
<div class="highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-1-1">1</a></span>
<span class="normal"><a href="#__codelineno-1-2">2</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-1-1" name="__codelineno-1-1"></a><span class="c1">-- To see the tables in the catalog</span>
<a id="__codelineno-1-2" name="__codelineno-1-2"></a><span class="k">select</span><span class="w"> </span><span class="k">system</span><span class="err">$</span><span class="n">list_iceberg_tables_from_catalog</span><span class="p">(</span><span class="s1">'fivetran_catalog_throwback_refinery'</span><span class="p">,</span><span class="w"> </span><span class="s1">''</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">);</span>
</code></pre></div></td></tr></tbody></table></div>
</div>
<div class="tabbed-block">
<div class="highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-2-1">1</a></span>
<span class="normal"><a href="#__codelineno-2-2">2</a></span>
<span class="normal"><a href="#__codelineno-2-3">3</a></span>
<span class="normal"><a href="#__codelineno-2-4">4</a></span>
<span class="normal"><a href="#__codelineno-2-5">5</a></span>
<span class="normal"><a href="#__codelineno-2-6">6</a></span>
<span class="normal"><a href="#__codelineno-2-7">7</a></span>
<span class="normal"><a href="#__codelineno-2-8">8</a></span>
<span class="normal"><a href="#__codelineno-2-9">9</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-2-1" name="__codelineno-2-1"></a><span class="p">[</span>
<a id="__codelineno-2-2" name="__codelineno-2-2"></a><span class="w">    </span><span class="p">{</span><span class="nt">"namespace"</span><span class="p">:</span><span class="s2">"google_analytics"</span><span class="p">,</span><span class="nt">"name"</span><span class="p">:</span><span class="s2">"conversion_events"</span><span class="p">},</span>
<a id="__codelineno-2-3" name="__codelineno-2-3"></a><span class="w">    </span><span class="p">{</span><span class="nt">"namespace"</span><span class="p">:</span><span class="s2">"google_analytics"</span><span class="p">,</span><span class="nt">"name"</span><span class="p">:</span><span class="s2">"events_report"</span><span class="p">},</span>
<a id="__codelineno-2-4" name="__codelineno-2-4"></a><span class="w">    </span><span class="p">{</span><span class="nt">"namespace"</span><span class="p">:</span><span class="s2">"google_analytics"</span><span class="p">,</span><span class="nt">"name"</span><span class="p">:</span><span class="s2">"accounts"</span><span class="p">},</span>
<a id="__codelineno-2-5" name="__codelineno-2-5"></a><span class="w">    </span><span class="p">{</span><span class="nt">"namespace"</span><span class="p">:</span><span class="s2">"google_analytics"</span><span class="p">,</span><span class="nt">"name"</span><span class="p">:</span><span class="s2">"content_group_report"</span><span class="p">},</span>
<a id="__codelineno-2-6" name="__codelineno-2-6"></a><span class="w">    </span><span class="p">{</span><span class="nt">"namespace"</span><span class="p">:</span><span class="s2">"google_analytics"</span><span class="p">,</span><span class="nt">"name"</span><span class="p">:</span><span class="s2">"audiences_report"</span><span class="p">},</span>
<a id="__codelineno-2-7" name="__codelineno-2-7"></a><span class="w">    </span><span class="p">{</span><span class="nt">"namespace"</span><span class="p">:</span><span class="s2">"google_analytics"</span><span class="p">,</span><span class="nt">"name"</span><span class="p">:</span><span class="s2">"properties"</span><span class="p">},</span>
<a id="__codelineno-2-8" name="__codelineno-2-8"></a><span class="w">    </span><span class="p">{</span><span class="nt">"namespace"</span><span class="p">:</span><span class="s2">"google_analytics"</span><span class="p">,</span><span class="nt">"name"</span><span class="p">:</span><span class="s2">"conversions_report"</span><span class="p">}</span>
<a id="__codelineno-2-9" name="__codelineno-2-9"></a><span class="p">]</span>
</code></pre></div></td></tr></tbody></table></div>
</div>
</div>
</div>
<h5 id="grant-access-in-gcp">Grant access in GCP</h5>
<p>We'll now need to allow Snowflake to interact with with bucket via the external volume. To do so we'll </p>
<div class="tabbed-set tabbed-alternate" data-tabs="2:3"><input checked="checked" id="__tabbed_2_1" name="__tabbed_2" type="radio"><input id="__tabbed_2_2" name="__tabbed_2" type="radio"><input id="__tabbed_2_3" name="__tabbed_2" type="radio"><div class="tabbed-labels"><label for="__tabbed_2_1"><span class="twemoji"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path d="M16 13.25A1.75 1.75 0 0 1 14.25 15H1.75A1.75 1.75 0 0 1 0 13.25V2.75C0 1.784.784 1 1.75 1h12.5c.966 0 1.75.784 1.75 1.75ZM1.75 2.5a.25.25 0 0 0-.25.25v10.5c0 .138.112.25.25.25h.94l.03-.03 6.077-6.078a1.75 1.75 0 0 1 2.412-.06L14.5 10.31V2.75a.25.25 0 0 0-.25-.25Zm12.5 11a.25.25 0 0 0 .25-.25v-.917l-4.298-3.889a.25.25 0 0 0-.344.009L4.81 13.5ZM7 6a2 2 0 1 1-3.999.001A2 2 0 0 1 7 6M5.5 6a.5.5 0 1 0-1 0 .5.5 0 0 0 1 0"></path></svg></span> Template</label><label for="__tabbed_2_2"><span class="twemoji"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path d="M16 13.25A1.75 1.75 0 0 1 14.25 15H1.75A1.75 1.75 0 0 1 0 13.25V2.75C0 1.784.784 1 1.75 1h12.5c.966 0 1.75.784 1.75 1.75ZM1.75 2.5a.25.25 0 0 0-.25.25v10.5c0 .138.112.25.25.25h.94l.03-.03 6.077-6.078a1.75 1.75 0 0 1 2.412-.06L14.5 10.31V2.75a.25.25 0 0 0-.25-.25Zm12.5 11a.25.25 0 0 0 .25-.25v-.917l-4.298-3.889a.25.25 0 0 0-.344.009L4.81 13.5ZM7 6a2 2 0 1 1-3.999.001A2 2 0 0 1 7 6M5.5 6a.5.5 0 1 0-1 0 .5.5 0 0 0 1 0"></path></svg></span> Example</label><label for="__tabbed_2_3"><span class="twemoji"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path d="M16 13.25A1.75 1.75 0 0 1 14.25 15H1.75A1.75 1.75 0 0 1 0 13.25V2.75C0 1.784.784 1 1.75 1h12.5c.966 0 1.75.784 1.75 1.75ZM1.75 2.5a.25.25 0 0 0-.25.25v10.5c0 .138.112.25.25.25h.94l.03-.03 6.077-6.078a1.75 1.75 0 0 1 2.412-.06L14.5 10.31V2.75a.25.25 0 0 0-.25-.25Zm12.5 11a.25.25 0 0 0 .25-.25v-.917l-4.298-3.889a.25.25 0 0 0-.344.009L4.81 13.5ZM7 6a2 2 0 1 1-3.999.001A2 2 0 0 1 7 6M5.5 6a.5.5 0 1 0-1 0 .5.5 0 0 0 1 0"></path></svg></span> Result</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-3-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-3-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-3-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-3-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-3-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-3-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-3-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-3-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-3-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-3-10">10</a></span>
<span class="normal"><a href="#__codelineno-3-11">11</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-3-1" name="__codelineno-3-1"></a><span class="n">use</span><span class="w"> </span><span class="k">role</span><span class="w"> </span><span class="n">accountadmin</span><span class="p">;</span>
<a id="__codelineno-3-2" name="__codelineno-3-2"></a>
<a id="__codelineno-3-3" name="__codelineno-3-3"></a><span class="c1">-- Get our principal url to be used in GCP so we can connect to the bucket.</span>
<a id="__codelineno-3-4" name="__codelineno-3-4"></a><span class="k">describe</span><span class="w"> </span><span class="k">external</span><span class="w"> </span><span class="n">volume</span><span class="w"> </span><span class="o">&lt;</span><span class="n">VOLUME</span><span class="w"> </span><span class="n">NAME</span><span class="w"> </span><span class="o">&gt;</span><span class="p">;</span>
<a id="__codelineno-3-5" name="__codelineno-3-5"></a><span class="k">select</span><span class="w"> </span>
<a id="__codelineno-3-6" name="__codelineno-3-6"></a><span class="w">    </span><span class="ss">"property"</span><span class="p">,</span>
<a id="__codelineno-3-7" name="__codelineno-3-7"></a><span class="w">    </span><span class="k">REPLACE</span><span class="p">(</span><span class="n">GET_PATH</span><span class="p">(</span><span class="n">PARSE_JSON</span><span class="p">(</span><span class="ss">"property_value"</span><span class="p">),</span><span class="w"> </span><span class="s1">'STORAGE_GCP_SERVICE_ACCOUNT'</span><span class="p">)::</span><span class="n">STRING</span><span class="p">,</span><span class="w"> </span><span class="s1">'"'</span><span class="p">,</span><span class="w"> </span><span class="s1">''</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">url</span>
<a id="__codelineno-3-8" name="__codelineno-3-8"></a><span class="k">from</span>
<a id="__codelineno-3-9" name="__codelineno-3-9"></a><span class="w">    </span><span class="k">table</span><span class="p">(</span><span class="n">result_scan</span><span class="p">(</span><span class="n">last_query_id</span><span class="p">()))</span>
<a id="__codelineno-3-10" name="__codelineno-3-10"></a><span class="k">where</span>
<a id="__codelineno-3-11" name="__codelineno-3-11"></a><span class="w">    </span><span class="ss">"property"</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">'STORAGE_LOCATION_1'</span><span class="p">;</span>
</code></pre></div></td></tr></tbody></table></div>
</div>
<div class="tabbed-block">
<div class="highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-4-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-4-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-4-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-4-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-4-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-4-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-4-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-4-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-4-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-4-10">10</a></span>
<span class="normal"><a href="#__codelineno-4-11">11</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-4-1" name="__codelineno-4-1"></a><span class="n">use</span><span class="w"> </span><span class="k">role</span><span class="w"> </span><span class="n">accountadmin</span><span class="p">;</span>
<a id="__codelineno-4-2" name="__codelineno-4-2"></a>
<a id="__codelineno-4-3" name="__codelineno-4-3"></a><span class="c1">-- Get our principal url to be used in GCP so we can connect to the bucket.</span>
<a id="__codelineno-4-4" name="__codelineno-4-4"></a><span class="k">describe</span><span class="w"> </span><span class="k">external</span><span class="w"> </span><span class="n">volume</span><span class="w"> </span><span class="n">fivetran_volume_throwback_refinery</span><span class="p">;</span>
<a id="__codelineno-4-5" name="__codelineno-4-5"></a><span class="k">select</span><span class="w"> </span>
<a id="__codelineno-4-6" name="__codelineno-4-6"></a><span class="w">    </span><span class="ss">"property"</span><span class="p">,</span>
<a id="__codelineno-4-7" name="__codelineno-4-7"></a><span class="w">    </span><span class="k">REPLACE</span><span class="p">(</span><span class="n">GET_PATH</span><span class="p">(</span><span class="n">PARSE_JSON</span><span class="p">(</span><span class="ss">"property_value"</span><span class="p">),</span><span class="w"> </span><span class="s1">'STORAGE_GCP_SERVICE_ACCOUNT'</span><span class="p">)::</span><span class="n">STRING</span><span class="p">,</span><span class="w"> </span><span class="s1">'"'</span><span class="p">,</span><span class="w"> </span><span class="s1">''</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">url</span>
<a id="__codelineno-4-8" name="__codelineno-4-8"></a><span class="k">from</span>
<a id="__codelineno-4-9" name="__codelineno-4-9"></a><span class="w">    </span><span class="k">table</span><span class="p">(</span><span class="n">result_scan</span><span class="p">(</span><span class="n">last_query_id</span><span class="p">()))</span>
<a id="__codelineno-4-10" name="__codelineno-4-10"></a><span class="k">where</span>
<a id="__codelineno-4-11" name="__codelineno-4-11"></a><span class="w">    </span><span class="ss">"property"</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">'STORAGE_LOCATION_1'</span><span class="p">;</span>
</code></pre></div></td></tr></tbody></table></div>
</div>
<div class="tabbed-block">
<table>
<thead>
<tr>
<th>property</th>
<th>URL</th>
</tr>
</thead>
<tbody>
<tr>
<td>STORAGE_LOCATION_1</td>
<td>kuyp12345@gcpuscentral1-1dfa.iam.gserviceaccount.com</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p>Let's navigate to IAM so that we can give snowflake access to our storage account.
<a class="glightbox" data-type="image" data-width="auto" data-height="auto" href="images/26.png" data-desc-position="bottom"><img alt="Navigate into IAM" src="images/26.png"></a></p>
<p>Create a new role.
<a class="glightbox" data-type="image" data-width="auto" data-height="auto" href="images/27.png" data-desc-position="bottom"><img alt="New Role" src="images/27.png"></a></p>
<p>Fill in the role information. We will call it <code>snowflake</code>. After that click <code>Add Permissions</code>.
<a class="glightbox" data-type="image" data-width="auto" data-height="auto" href="images/28.png" data-desc-position="bottom"><img alt="Role information" src="images/28.png"></a></p>
<p>The permissions to select can be found on <a href="https://docs.snowflake.com/en/user-guide/data-load-gcs-config#creating-a-custom-iam-role">Snowflake's documentation</a>. In this tutorial I have chosen <code>Data loading and unloading</code>. I have also provided a gif to show how to select the permissions because the user interface is terrible.
<a class="glightbox" data-type="image" data-width="auto" data-height="auto" href="images/29.gif" data-desc-position="bottom"><img alt="Add permissions" src="images/29.gif"></a></p>
<p>Navigate back to our bucket. Click <code>permissions</code>, followed by <code>add principle</code>.
<a class="glightbox" data-type="image" data-width="auto" data-height="auto" href="images/30.png" data-desc-position="bottom"><img alt="Navigate to bucket and permissions" src="images/30.png"></a></p>
<p>In the new principles section, add your URL given by Snowflake earlier.
<a class="glightbox" data-type="image" data-width="auto" data-height="auto" href="images/31.png" data-desc-position="bottom"><img alt="Add snowflake service account" src="images/31.png"></a></p>
<p>Now add your role by clicking <code>select role</code> -&gt; <code>custom</code> -&gt; <code>snowflake</code>. The last one will be your role name.
<a class="glightbox" data-type="image" data-width="auto" data-height="auto" href="images/32.png" data-desc-position="bottom"><img alt="Add role" src="images/32.png"></a></p>
<details class="warning">
<summary>If you get a 'Domain restricted sharing' error when you click 'Save'. </summary>
<p>If you run into this error it's because google cloud has updated their policy as of March 2024. We'll have to update them. First select your organization (not your project), then go to IAM in the search, followed by clicking "grant access".
<a class="glightbox" data-type="image" data-width="auto" data-height="auto" href="images/34.png" data-desc-position="bottom"><img alt="navigate to grant access" src="images/34.png"></a></p>
<p>Next we'll add our user email into the new principals area. We'll search and click on "Organization Policy Administrator".
<a class="glightbox" data-type="image" data-width="auto" data-height="auto" href="images/35.png" data-desc-position="bottom"><img alt="org policy admin" src="images/35.png"></a></p>
<p>Click save.
<a class="glightbox" data-type="image" data-width="auto" data-height="auto" href="images/36.png" data-desc-position="bottom"><img alt="update" src="images/36.png"></a></p>
<p>Next we'll want to update the policy. By searching IAM, selecting organization policies, searching domain and clicking on "Domain restricted sharing".
<a class="glightbox" data-type="image" data-width="auto" data-height="auto" href="images/37.png" data-desc-position="bottom"><img alt="update" src="images/37.png"></a></p>
<p>Click Manage policy.
<a class="glightbox" data-type="image" data-width="auto" data-height="auto" href="images/38.png" data-desc-position="bottom"><img alt="update" src="images/38.png"></a></p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>"Allow All" is the simple approach but feel free to use <a href="https://docs.snowflake.com/en/user-guide/data-load-gcs-config#assigning-the-custom-role-to-the-cloud-storage-service-account">more fine grain approach via Snowflake documentation</a>.</p>
</div>
<p>We'll want to override the parent policy with a new rule. Select replace the policy and then select "Allow All". Click done and "Set Policy." and your good to go. 
<a class="glightbox" data-type="image" data-width="auto" data-height="auto" href="images/39.png" data-desc-position="bottom"><img alt="update" src="images/39.png"></a></p>
<p>The policy has been updated and you can retry adding the role to the new principal.
<a class="glightbox" data-type="image" data-width="auto" data-height="auto" href="images/40.png" data-desc-position="bottom"><img alt="update" src="images/40.png"></a></p>
</details>
<p>Click <code>Save</code> and you're finished GCP setup.
<a class="glightbox" data-type="image" data-width="auto" data-height="auto" href="images/33.png" data-desc-position="bottom"><img alt="Click Save" src="images/33.png"></a></p>
<h2 id="load-source-data">Load source data</h2>
<p>This section will be vary depending on what source you plan to use. In my example I would load some data from google analytics by adding it as a connector.
<a class="glightbox" data-type="image" data-width="auto" data-height="auto" href="images/22.png" data-desc-position="bottom"><img alt="UPDATE" src="images/22.png"></a></p>
<p>Now if we check our bucket you can see fivetran has loaded the google analytics data into our data lake.
<a class="glightbox" data-type="image" data-width="auto" data-height="auto" href="images/23.png" data-desc-position="bottom"><img alt="UPDATE" src="images/23.png"></a></p>
<h2 id="create-table">Create - Table  <span class="twemoji"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path d="M7.22 6.5a.72.72 0 1 1-1.44 0 .72.72 0 0 1 1.44 0"></path><path d="M8 16A8 8 0 1 1 8 0a8 8 0 0 1 0 16M4 5v3.38c.001.397.159.778.44 1.059l3.211 3.213a1.2 1.2 0 0 0 1.698 0l3.303-3.303a1.2 1.2 0 0 0 0-1.698L9.439 4.44A1.5 1.5 0 0 0 8.379 4H5a1 1 0 0 0-1 1"></path></svg></span></h2>
<p>Let's create a database, schema and our first table in Snowflake using everything we have created.</p>
<div class="tabbed-set tabbed-alternate" data-tabs="3:3"><input checked="checked" id="__tabbed_3_1" name="__tabbed_3" type="radio"><input id="__tabbed_3_2" name="__tabbed_3" type="radio"><input id="__tabbed_3_3" name="__tabbed_3" type="radio"><div class="tabbed-labels"><label for="__tabbed_3_1"><span class="twemoji"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path d="M16 13.25A1.75 1.75 0 0 1 14.25 15H1.75A1.75 1.75 0 0 1 0 13.25V2.75C0 1.784.784 1 1.75 1h12.5c.966 0 1.75.784 1.75 1.75ZM1.75 2.5a.25.25 0 0 0-.25.25v10.5c0 .138.112.25.25.25h.94l.03-.03 6.077-6.078a1.75 1.75 0 0 1 2.412-.06L14.5 10.31V2.75a.25.25 0 0 0-.25-.25Zm12.5 11a.25.25 0 0 0 .25-.25v-.917l-4.298-3.889a.25.25 0 0 0-.344.009L4.81 13.5ZM7 6a2 2 0 1 1-3.999.001A2 2 0 0 1 7 6M5.5 6a.5.5 0 1 0-1 0 .5.5 0 0 0 1 0"></path></svg></span> Template</label><label for="__tabbed_3_2"><span class="twemoji"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path d="M16 13.25A1.75 1.75 0 0 1 14.25 15H1.75A1.75 1.75 0 0 1 0 13.25V2.75C0 1.784.784 1 1.75 1h12.5c.966 0 1.75.784 1.75 1.75ZM1.75 2.5a.25.25 0 0 0-.25.25v10.5c0 .138.112.25.25.25h.94l.03-.03 6.077-6.078a1.75 1.75 0 0 1 2.412-.06L14.5 10.31V2.75a.25.25 0 0 0-.25-.25Zm12.5 11a.25.25 0 0 0 .25-.25v-.917l-4.298-3.889a.25.25 0 0 0-.344.009L4.81 13.5ZM7 6a2 2 0 1 1-3.999.001A2 2 0 0 1 7 6M5.5 6a.5.5 0 1 0-1 0 .5.5 0 0 0 1 0"></path></svg></span> Example</label><label for="__tabbed_3_3"><span class="twemoji"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path d="M16 13.25A1.75 1.75 0 0 1 14.25 15H1.75A1.75 1.75 0 0 1 0 13.25V2.75C0 1.784.784 1 1.75 1h12.5c.966 0 1.75.784 1.75 1.75ZM1.75 2.5a.25.25 0 0 0-.25.25v10.5c0 .138.112.25.25.25h.94l.03-.03 6.077-6.078a1.75 1.75 0 0 1 2.412-.06L14.5 10.31V2.75a.25.25 0 0 0-.25-.25Zm12.5 11a.25.25 0 0 0 .25-.25v-.917l-4.298-3.889a.25.25 0 0 0-.344.009L4.81 13.5ZM7 6a2 2 0 1 1-3.999.001A2 2 0 0 1 7 6M5.5 6a.5.5 0 1 0-1 0 .5.5 0 0 0 1 0"></path></svg></span> Result</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-5-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-5-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-5-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-5-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-5-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-5-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-5-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-5-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-5-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-5-10">10</a></span>
<span class="normal"><a href="#__codelineno-5-11">11</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-5-1" name="__codelineno-5-1"></a><span class="c1">-- Create the database and schema to store the tables.</span>
<a id="__codelineno-5-2" name="__codelineno-5-2"></a><span class="k">create</span><span class="w"> </span><span class="k">or</span><span class="w"> </span><span class="k">replace</span><span class="w"> </span><span class="k">database</span><span class="w"> </span><span class="o">&lt;</span><span class="k">Database</span><span class="w"> </span><span class="n">name</span><span class="o">&gt;</span><span class="p">;</span>
<a id="__codelineno-5-3" name="__codelineno-5-3"></a><span class="k">create</span><span class="w"> </span><span class="k">or</span><span class="w"> </span><span class="k">replace</span><span class="w"> </span><span class="k">schema</span><span class="w"> </span><span class="o">&lt;</span><span class="k">Schema</span><span class="o">&gt;</span><span class="p">;</span>
<a id="__codelineno-5-4" name="__codelineno-5-4"></a>
<a id="__codelineno-5-5" name="__codelineno-5-5"></a><span class="c1">-- Create the table from  the data and the catalog.</span>
<a id="__codelineno-5-6" name="__codelineno-5-6"></a><span class="k">create</span><span class="w"> </span><span class="k">or</span><span class="w"> </span><span class="k">replace</span><span class="w"> </span><span class="n">iceberg</span><span class="w"> </span><span class="k">table</span><span class="w"> </span><span class="o">&lt;</span><span class="k">Table</span><span class="w"> </span><span class="n">name</span><span class="o">&gt;</span>
<a id="__codelineno-5-7" name="__codelineno-5-7"></a><span class="w">    </span><span class="n">external_volume</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">'&lt;volume&gt;'</span>
<a id="__codelineno-5-8" name="__codelineno-5-8"></a><span class="w">    </span><span class="k">catalog</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">'&lt;catalog&gt;'</span>
<a id="__codelineno-5-9" name="__codelineno-5-9"></a><span class="w">    </span><span class="n">catalog_namespace</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">'&lt;source name&gt;'</span>
<a id="__codelineno-5-10" name="__codelineno-5-10"></a><span class="w">    </span><span class="n">catalog_table_name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">'&lt;table name&gt;'</span>
<a id="__codelineno-5-11" name="__codelineno-5-11"></a><span class="w">    </span><span class="n">auto_refresh</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">true</span><span class="p">;</span>
</code></pre></div></td></tr></tbody></table></div>
</div>
<div class="tabbed-block">
<div class="highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-6-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-6-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-6-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-6-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-6-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-6-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-6-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-6-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-6-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-6-10">10</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-6-1" name="__codelineno-6-1"></a><span class="k">create</span><span class="w"> </span><span class="k">or</span><span class="w"> </span><span class="k">replace</span><span class="w"> </span><span class="k">database</span><span class="w"> </span><span class="n">fivetran</span><span class="p">;</span>
<a id="__codelineno-6-2" name="__codelineno-6-2"></a><span class="k">create</span><span class="w"> </span><span class="k">or</span><span class="w"> </span><span class="k">replace</span><span class="w"> </span><span class="k">schema</span><span class="w"> </span><span class="n">google_analytics_4</span><span class="p">;</span>
<a id="__codelineno-6-3" name="__codelineno-6-3"></a>
<a id="__codelineno-6-4" name="__codelineno-6-4"></a><span class="c1">-- Create the table from  the data and the catalog.</span>
<a id="__codelineno-6-5" name="__codelineno-6-5"></a><span class="k">create</span><span class="w"> </span><span class="k">or</span><span class="w"> </span><span class="k">replace</span><span class="w"> </span><span class="n">iceberg</span><span class="w"> </span><span class="k">table</span><span class="w"> </span><span class="n">accounts</span>
<a id="__codelineno-6-6" name="__codelineno-6-6"></a><span class="w">    </span><span class="n">external_volume</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">'fivetran_volume_throwback_refinery'</span>
<a id="__codelineno-6-7" name="__codelineno-6-7"></a><span class="w">    </span><span class="k">catalog</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">'fivetran_catalog_throwback_refinery'</span>
<a id="__codelineno-6-8" name="__codelineno-6-8"></a><span class="w">    </span><span class="n">catalog_namespace</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">'google_analytics_4'</span>
<a id="__codelineno-6-9" name="__codelineno-6-9"></a><span class="w">    </span><span class="n">catalog_table_name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">'accounts'</span>
<a id="__codelineno-6-10" name="__codelineno-6-10"></a><span class="w">    </span><span class="n">auto_refresh</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">true</span><span class="p">;</span>
</code></pre></div></td></tr></tbody></table></div>
</div>
<div class="tabbed-block">
<p>UPDATE</p>
</div>
</div>
</div>
<p>Now that we have our first table created let's query from it.</p>
<div class="tabbed-set tabbed-alternate" data-tabs="4:2"><input checked="checked" id="__tabbed_4_1" name="__tabbed_4" type="radio"><input id="__tabbed_4_2" name="__tabbed_4" type="radio"><div class="tabbed-labels"><label for="__tabbed_4_1"><span class="twemoji"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path d="M16 13.25A1.75 1.75 0 0 1 14.25 15H1.75A1.75 1.75 0 0 1 0 13.25V2.75C0 1.784.784 1 1.75 1h12.5c.966 0 1.75.784 1.75 1.75ZM1.75 2.5a.25.25 0 0 0-.25.25v10.5c0 .138.112.25.25.25h.94l.03-.03 6.077-6.078a1.75 1.75 0 0 1 2.412-.06L14.5 10.31V2.75a.25.25 0 0 0-.25-.25Zm12.5 11a.25.25 0 0 0 .25-.25v-.917l-4.298-3.889a.25.25 0 0 0-.344.009L4.81 13.5ZM7 6a2 2 0 1 1-3.999.001A2 2 0 0 1 7 6M5.5 6a.5.5 0 1 0-1 0 .5.5 0 0 0 1 0"></path></svg></span> Example</label><label for="__tabbed_4_2"><span class="twemoji"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path d="M16 13.25A1.75 1.75 0 0 1 14.25 15H1.75A1.75 1.75 0 0 1 0 13.25V2.75C0 1.784.784 1 1.75 1h12.5c.966 0 1.75.784 1.75 1.75ZM1.75 2.5a.25.25 0 0 0-.25.25v10.5c0 .138.112.25.25.25h.94l.03-.03 6.077-6.078a1.75 1.75 0 0 1 2.412-.06L14.5 10.31V2.75a.25.25 0 0 0-.25-.25Zm12.5 11a.25.25 0 0 0 .25-.25v-.917l-4.298-3.889a.25.25 0 0 0-.344.009L4.81 13.5ZM7 6a2 2 0 1 1-3.999.001A2 2 0 0 1 7 6M5.5 6a.5.5 0 1 0-1 0 .5.5 0 0 0 1 0"></path></svg></span> Result</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-7-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-7-1" name="__codelineno-7-1"></a><span class="k">select</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">accounts</span><span class="p">;</span>
</code></pre></div></td></tr></tbody></table></div>
</div>
<div class="tabbed-block">
<table>
<thead>
<tr>
<th>NAME</th>
<th>DISPLAY_NAME</th>
<th>REGION_CODE</th>
<th>_FIVETRAN_SYNCED</th>
</tr>
</thead>
<tbody>
<tr>
<td>accounts/302439834</td>
<td>danielwilczak</td>
<td>US</td>
<td>2025-04-24 19:48:34.101 -0700</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<h2 id="automate-table-creation">Automate - Table Creation  <span class="twemoji"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path d="M7.22 6.5a.72.72 0 1 1-1.44 0 .72.72 0 0 1 1.44 0"></path><path d="M8 16A8 8 0 1 1 8 0a8 8 0 0 1 0 16M4 5v3.38c.001.397.159.778.44 1.059l3.211 3.213a1.2 1.2 0 0 0 1.698 0l3.303-3.303a1.2 1.2 0 0 0 0-1.698L9.439 4.44A1.5 1.5 0 0 0 8.379 4H5a1 1 0 0 0-1 1"></path></svg></span></h2>
<p>Now let's automate the creation of all the tables using a Py. We'll add this python code into a "thon scriptPython Worksheet". We'll want to fill in our "catalog integration name" and "external volume name" that we got from fivetran.</p>
<div class="tabbed-set tabbed-alternate" data-tabs="5:3"><input checked="checked" id="__tabbed_5_1" name="__tabbed_5" type="radio"><input id="__tabbed_5_2" name="__tabbed_5" type="radio"><input id="__tabbed_5_3" name="__tabbed_5" type="radio"><div class="tabbed-labels"><label for="__tabbed_5_1"><span class="twemoji"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path d="M16 13.25A1.75 1.75 0 0 1 14.25 15H1.75A1.75 1.75 0 0 1 0 13.25V2.75C0 1.784.784 1 1.75 1h12.5c.966 0 1.75.784 1.75 1.75ZM1.75 2.5a.25.25 0 0 0-.25.25v10.5c0 .138.112.25.25.25h.94l.03-.03 6.077-6.078a1.75 1.75 0 0 1 2.412-.06L14.5 10.31V2.75a.25.25 0 0 0-.25-.25Zm12.5 11a.25.25 0 0 0 .25-.25v-.917l-4.298-3.889a.25.25 0 0 0-.344.009L4.81 13.5ZM7 6a2 2 0 1 1-3.999.001A2 2 0 0 1 7 6M5.5 6a.5.5 0 1 0-1 0 .5.5 0 0 0 1 0"></path></svg></span> Example</label><label for="__tabbed_5_2"><span class="twemoji"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path d="M16 13.25A1.75 1.75 0 0 1 14.25 15H1.75A1.75 1.75 0 0 1 0 13.25V2.75C0 1.784.784 1 1.75 1h12.5c.966 0 1.75.784 1.75 1.75ZM1.75 2.5a.25.25 0 0 0-.25.25v10.5c0 .138.112.25.25.25h.94l.03-.03 6.077-6.078a1.75 1.75 0 0 1 2.412-.06L14.5 10.31V2.75a.25.25 0 0 0-.25-.25Zm12.5 11a.25.25 0 0 0 .25-.25v-.917l-4.298-3.889a.25.25 0 0 0-.344.009L4.81 13.5ZM7 6a2 2 0 1 1-3.999.001A2 2 0 0 1 7 6M5.5 6a.5.5 0 1 0-1 0 .5.5 0 0 0 1 0"></path></svg></span> Example</label><label for="__tabbed_5_3"><span class="twemoji"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path d="M16 13.25A1.75 1.75 0 0 1 14.25 15H1.75A1.75 1.75 0 0 1 0 13.25V2.75C0 1.784.784 1 1.75 1h12.5c.966 0 1.75.784 1.75 1.75ZM1.75 2.5a.25.25 0 0 0-.25.25v10.5c0 .138.112.25.25.25h.94l.03-.03 6.077-6.078a1.75 1.75 0 0 1 2.412-.06L14.5 10.31V2.75a.25.25 0 0 0-.25-.25Zm12.5 11a.25.25 0 0 0 .25-.25v-.917l-4.298-3.889a.25.25 0 0 0-.344.009L4.81 13.5ZM7 6a2 2 0 1 1-3.999.001A2 2 0 0 1 7 6M5.5 6a.5.5 0 1 0-1 0 .5.5 0 0 0 1 0"></path></svg></span> Result</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-8-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-8-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-8-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-8-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-8-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-8-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-8-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-8-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-8-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-8-10">10</a></span>
<span class="normal"><a href="#__codelineno-8-11">11</a></span>
<span class="normal"><a href="#__codelineno-8-12">12</a></span>
<span class="normal"><a href="#__codelineno-8-13">13</a></span>
<span class="normal"><a href="#__codelineno-8-14">14</a></span>
<span class="normal"><a href="#__codelineno-8-15">15</a></span>
<span class="normal"><a href="#__codelineno-8-16">16</a></span>
<span class="normal"><a href="#__codelineno-8-17">17</a></span>
<span class="normal"><a href="#__codelineno-8-18">18</a></span>
<span class="normal"><a href="#__codelineno-8-19">19</a></span>
<span class="normal"><a href="#__codelineno-8-20">20</a></span>
<span class="normal"><a href="#__codelineno-8-21">21</a></span>
<span class="normal"><a href="#__codelineno-8-22">22</a></span>
<span class="normal"><a href="#__codelineno-8-23">23</a></span>
<span class="normal"><a href="#__codelineno-8-24">24</a></span>
<span class="normal"><a href="#__codelineno-8-25">25</a></span>
<span class="normal"><a href="#__codelineno-8-26">26</a></span>
<span class="normal"><a href="#__codelineno-8-27">27</a></span>
<span class="normal"><a href="#__codelineno-8-28">28</a></span>
<span class="normal"><a href="#__codelineno-8-29">29</a></span>
<span class="normal"><a href="#__codelineno-8-30">30</a></span>
<span class="normal"><a href="#__codelineno-8-31">31</a></span>
<span class="normal"><a href="#__codelineno-8-32">32</a></span>
<span class="normal"><a href="#__codelineno-8-33">33</a></span>
<span class="normal"><a href="#__codelineno-8-34">34</a></span>
<span class="normal"><a href="#__codelineno-8-35">35</a></span>
<span class="normal"><a href="#__codelineno-8-36">36</a></span>
<span class="normal"><a href="#__codelineno-8-37">37</a></span>
<span class="normal"><a href="#__codelineno-8-38">38</a></span>
<span class="normal"><a href="#__codelineno-8-39">39</a></span>
<span class="normal"><a href="#__codelineno-8-40">40</a></span>
<span class="normal"><a href="#__codelineno-8-41">41</a></span>
<span class="normal"><a href="#__codelineno-8-42">42</a></span>
<span class="normal"><a href="#__codelineno-8-43">43</a></span>
<span class="normal"><a href="#__codelineno-8-44">44</a></span>
<span class="normal"><a href="#__codelineno-8-45">45</a></span>
<span class="normal"><a href="#__codelineno-8-46">46</a></span>
<span class="normal"><a href="#__codelineno-8-47">47</a></span>
<span class="normal"><a href="#__codelineno-8-48">48</a></span>
<span class="normal"><a href="#__codelineno-8-49">49</a></span>
<span class="normal"><a href="#__codelineno-8-50">50</a></span>
<span class="normal"><a href="#__codelineno-8-51">51</a></span>
<span class="normal"><a href="#__codelineno-8-52">52</a></span>
<span class="normal"><a href="#__codelineno-8-53">53</a></span>
<span class="normal"><a href="#__codelineno-8-54">54</a></span>
<span class="normal"><a href="#__codelineno-8-55">55</a></span>
<span class="normal"><a href="#__codelineno-8-56">56</a></span>
<span class="normal"><a href="#__codelineno-8-57">57</a></span>
<span class="normal"><a href="#__codelineno-8-58">58</a></span>
<span class="normal"><a href="#__codelineno-8-59">59</a></span>
<span class="normal"><a href="#__codelineno-8-60">60</a></span>
<span class="normal"><a href="#__codelineno-8-61">61</a></span>
<span class="normal"><a href="#__codelineno-8-62">62</a></span>
<span class="normal"><a href="#__codelineno-8-63">63</a></span>
<span class="normal"><a href="#__codelineno-8-64">64</a></span>
<span class="normal"><a href="#__codelineno-8-65">65</a></span>
<span class="normal"><a href="#__codelineno-8-66">66</a></span>
<span class="normal"><a href="#__codelineno-8-67">67</a></span>
<span class="normal"><a href="#__codelineno-8-68">68</a></span>
<span class="normal"><a href="#__codelineno-8-69">69</a></span>
<span class="normal"><a href="#__codelineno-8-70">70</a></span>
<span class="normal"><a href="#__codelineno-8-71">71</a></span>
<span class="normal"><a href="#__codelineno-8-72">72</a></span>
<span class="normal"><a href="#__codelineno-8-73">73</a></span>
<span class="normal"><a href="#__codelineno-8-74">74</a></span>
<span class="normal"><a href="#__codelineno-8-75">75</a></span>
<span class="normal"><a href="#__codelineno-8-76">76</a></span>
<span class="normal"><a href="#__codelineno-8-77">77</a></span>
<span class="normal"><a href="#__codelineno-8-78">78</a></span>
<span class="normal"><a href="#__codelineno-8-79">79</a></span>
<span class="normal"><a href="#__codelineno-8-80">80</a></span>
<span class="normal"><a href="#__codelineno-8-81">81</a></span>
<span class="normal"><a href="#__codelineno-8-82">82</a></span>
<span class="normal"><a href="#__codelineno-8-83">83</a></span>
<span class="normal"><a href="#__codelineno-8-84">84</a></span>
<span class="normal"><a href="#__codelineno-8-85">85</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-8-1" name="__codelineno-8-1"></a><span class="kn">import</span><span class="w"> </span><span class="nn">snowflake.snowpark</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">snowpark</span>
<a id="__codelineno-8-2" name="__codelineno-8-2"></a><span class="kn">from</span><span class="w"> </span><span class="nn">snowflake.snowpark.functions</span><span class="w"> </span><span class="kn">import</span> <span class="n">col</span><span class="p">,</span> <span class="n">lit</span>
<a id="__codelineno-8-3" name="__codelineno-8-3"></a><span class="kn">import</span><span class="w"> </span><span class="nn">json</span>
<a id="__codelineno-8-4" name="__codelineno-8-4"></a><span class="kn">import</span><span class="w"> </span><span class="nn">datetime</span>
<a id="__codelineno-8-5" name="__codelineno-8-5"></a><span class="kn">import</span><span class="w"> </span><span class="nn">pandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pd</span>
<a id="__codelineno-8-6" name="__codelineno-8-6"></a><span class="kn">from</span><span class="w"> </span><span class="nn">functools</span><span class="w"> </span><span class="kn">import</span> <span class="n">reduce</span>
<a id="__codelineno-8-7" name="__codelineno-8-7"></a>
<a id="__codelineno-8-8" name="__codelineno-8-8"></a><span class="n">CATALOG_INTEGRATION_NAME</span> <span class="o">=</span> <span class="s1">'&lt;Catalog name&gt;'</span>
<a id="__codelineno-8-9" name="__codelineno-8-9"></a><span class="n">EXTERNAL_VOLUME_NAME</span>     <span class="o">=</span> <span class="s1">'&lt;External volume name&gt;'</span>
<a id="__codelineno-8-10" name="__codelineno-8-10"></a>
<a id="__codelineno-8-11" name="__codelineno-8-11"></a><span class="k">def</span><span class="w"> </span><span class="nf">main</span><span class="p">(</span><span class="n">session</span><span class="p">:</span> <span class="n">snowpark</span><span class="o">.</span><span class="n">Session</span><span class="p">):</span>
<a id="__codelineno-8-12" name="__codelineno-8-12"></a>    <span class="c1"># Fetch a list of tables from the external catalog</span>
<a id="__codelineno-8-13" name="__codelineno-8-13"></a>    <span class="n">external_catalog_tables</span> <span class="o">=</span> <span class="p">[</span>
<a id="__codelineno-8-14" name="__codelineno-8-14"></a>        <span class="n">row</span>
<a id="__codelineno-8-15" name="__codelineno-8-15"></a>        <span class="k">for</span> <span class="n">rs</span> <span class="ow">in</span> <span class="n">session</span><span class="o">.</span><span class="n">sql</span><span class="p">(</span><span class="sa">f</span><span class="s2">"select SYSTEM$LIST_ICEBERG_TABLES_FROM_CATALOG('</span><span class="si">{</span><span class="n">CATALOG_INTEGRATION_NAME</span><span class="si">}</span><span class="s2">','',0) as TABLE_LIST"</span><span class="p">)</span><span class="o">.</span><span class="n">collect</span><span class="p">()</span>
<a id="__codelineno-8-16" name="__codelineno-8-16"></a>        <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">rs</span><span class="o">.</span><span class="n">as_dict</span><span class="p">()[</span><span class="s2">"TABLE_LIST"</span><span class="p">])</span>
<a id="__codelineno-8-17" name="__codelineno-8-17"></a>    <span class="p">]</span>
<a id="__codelineno-8-18" name="__codelineno-8-18"></a>
<a id="__codelineno-8-19" name="__codelineno-8-19"></a>    <span class="c1"># Convert the tables to the appropriate CREATE SCHEMA and CREATE ICEBERG TABLE statements</span>
<a id="__codelineno-8-20" name="__codelineno-8-20"></a>    <span class="n">statements</span> <span class="o">=</span> <span class="p">[</span>
<a id="__codelineno-8-21" name="__codelineno-8-21"></a>        <span class="n">sql</span>
<a id="__codelineno-8-22" name="__codelineno-8-22"></a>        <span class="k">for</span> <span class="n">table</span> <span class="ow">in</span> <span class="n">external_catalog_tables</span>
<a id="__codelineno-8-23" name="__codelineno-8-23"></a>        <span class="k">for</span> <span class="n">sql</span> <span class="ow">in</span> <span class="p">[</span><span class="n">create_schema</span><span class="p">(</span><span class="n">table</span><span class="p">),</span> <span class="n">create_table</span><span class="p">(</span><span class="n">table</span><span class="p">)]</span>
<a id="__codelineno-8-24" name="__codelineno-8-24"></a>    <span class="p">]</span>
<a id="__codelineno-8-25" name="__codelineno-8-25"></a>
<a id="__codelineno-8-26" name="__codelineno-8-26"></a>    <span class="c1"># Execute each of the statements and merge the resulting dataframes into one combined dataframe to show the user</span>
<a id="__codelineno-8-27" name="__codelineno-8-27"></a>    <span class="n">results</span> <span class="o">=</span> <span class="n">reduce</span><span class="p">(</span><span class="k">lambda</span> <span class="n">left</span><span class="p">,</span> <span class="n">right</span><span class="p">:</span> <span class="n">left</span><span class="o">.</span><span class="n">union_all</span><span class="p">(</span><span class="n">right</span><span class="p">),</span> <span class="p">[</span>
<a id="__codelineno-8-28" name="__codelineno-8-28"></a>        <span class="n">exec</span><span class="p">(</span><span class="n">session</span><span class="p">,</span> <span class="n">statement</span><span class="p">)</span>
<a id="__codelineno-8-29" name="__codelineno-8-29"></a>        <span class="k">for</span> <span class="n">statement</span> <span class="ow">in</span> <span class="n">statements</span>
<a id="__codelineno-8-30" name="__codelineno-8-30"></a>    <span class="p">])</span>
<a id="__codelineno-8-31" name="__codelineno-8-31"></a>
<a id="__codelineno-8-32" name="__codelineno-8-32"></a>    <span class="c1"># Identify any tables that exist in CURRENT_DATABASE() that are not tracked in the external catalog and optionally</span>
<a id="__codelineno-8-33" name="__codelineno-8-33"></a>    <span class="n">sync_dropped_tables</span><span class="p">(</span><span class="n">session</span><span class="p">,</span> <span class="n">external_catalog_tables</span><span class="p">,</span> <span class="n">drop</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<a id="__codelineno-8-34" name="__codelineno-8-34"></a>
<a id="__codelineno-8-35" name="__codelineno-8-35"></a>    <span class="k">return</span> <span class="n">results</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">col</span><span class="p">(</span><span class="s1">'statement_timestamp'</span><span class="p">))</span>
<a id="__codelineno-8-36" name="__codelineno-8-36"></a>
<a id="__codelineno-8-37" name="__codelineno-8-37"></a><span class="k">def</span><span class="w"> </span><span class="nf">create_schema</span><span class="p">(</span><span class="n">table</span><span class="p">):</span>
<a id="__codelineno-8-38" name="__codelineno-8-38"></a>    <span class="k">return</span> <span class="sa">f</span><span class="s2">"""</span>
<a id="__codelineno-8-39" name="__codelineno-8-39"></a><span class="s2">CREATE SCHEMA if not exists </span><span class="si">{</span><span class="n">table</span><span class="p">[</span><span class="s1">'namespace'</span><span class="p">]</span><span class="si">}</span>
<a id="__codelineno-8-40" name="__codelineno-8-40"></a><span class="s2">EXTERNAL_VOLUME = '</span><span class="si">{</span><span class="n">EXTERNAL_VOLUME_NAME</span><span class="si">}</span><span class="s2">'</span>
<a id="__codelineno-8-41" name="__codelineno-8-41"></a><span class="s2">CATALOG='</span><span class="si">{</span><span class="n">CATALOG_INTEGRATION_NAME</span><span class="si">}</span><span class="s2">'</span>
<a id="__codelineno-8-42" name="__codelineno-8-42"></a><span class="s2">"""</span>
<a id="__codelineno-8-43" name="__codelineno-8-43"></a>
<a id="__codelineno-8-44" name="__codelineno-8-44"></a><span class="k">def</span><span class="w"> </span><span class="nf">create_table</span><span class="p">(</span><span class="n">table</span><span class="p">):</span>
<a id="__codelineno-8-45" name="__codelineno-8-45"></a>    <span class="k">return</span> <span class="sa">f</span><span class="s2">"""</span>
<a id="__codelineno-8-46" name="__codelineno-8-46"></a><span class="s2">CREATE OR REPLACE ICEBERG TABLE </span><span class="si">{</span><span class="n">table</span><span class="p">[</span><span class="s1">'namespace'</span><span class="p">]</span><span class="si">}</span><span class="s2">.</span><span class="si">{</span><span class="n">table</span><span class="p">[</span><span class="s1">'name'</span><span class="p">]</span><span class="si">}</span>
<a id="__codelineno-8-47" name="__codelineno-8-47"></a><span class="s2">EXTERNAL_VOLUME = '</span><span class="si">{</span><span class="n">EXTERNAL_VOLUME_NAME</span><span class="si">}</span><span class="s2">'</span>
<a id="__codelineno-8-48" name="__codelineno-8-48"></a><span class="s2">CATALOG='</span><span class="si">{</span><span class="n">CATALOG_INTEGRATION_NAME</span><span class="si">}</span><span class="s2">'</span>
<a id="__codelineno-8-49" name="__codelineno-8-49"></a><span class="s2">CATALOG_NAMESPACE= '</span><span class="si">{</span><span class="n">table</span><span class="p">[</span><span class="s1">'namespace'</span><span class="p">]</span><span class="si">}</span><span class="s2">'</span>
<a id="__codelineno-8-50" name="__codelineno-8-50"></a><span class="s2">CATALOG_TABLE_NAME = '</span><span class="si">{</span><span class="n">table</span><span class="p">[</span><span class="s1">'name'</span><span class="p">]</span><span class="si">}</span><span class="s2">'</span>
<a id="__codelineno-8-51" name="__codelineno-8-51"></a><span class="s2">AUTO_REFRESH=TRUE;</span>
<a id="__codelineno-8-52" name="__codelineno-8-52"></a><span class="s2">"""</span>
<a id="__codelineno-8-53" name="__codelineno-8-53"></a>
<a id="__codelineno-8-54" name="__codelineno-8-54"></a><span class="k">def</span><span class="w"> </span><span class="nf">exec_and_aggregate_results</span><span class="p">(</span><span class="n">session</span><span class="p">:</span> <span class="n">snowpark</span><span class="o">.</span><span class="n">Session</span><span class="p">,</span> <span class="n">dataframe</span><span class="p">:</span> <span class="n">snowpark</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">sql</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">snowpark</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<a id="__codelineno-8-55" name="__codelineno-8-55"></a>    <span class="n">results</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">sql</span><span class="p">(</span><span class="n">sql</span><span class="p">)</span>
<a id="__codelineno-8-56" name="__codelineno-8-56"></a>    <span class="n">results</span> <span class="o">=</span> <span class="n">results</span><span class="o">.</span><span class="n">with_column</span><span class="p">(</span><span class="s1">'statement_timestamp'</span><span class="p">,</span> <span class="n">lit</span><span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()))</span>
<a id="__codelineno-8-57" name="__codelineno-8-57"></a>    <span class="n">results</span> <span class="o">=</span> <span class="n">results</span><span class="o">.</span><span class="n">with_column</span><span class="p">(</span><span class="s1">'statement'</span><span class="p">,</span> <span class="n">lit</span><span class="p">(</span><span class="n">sql</span><span class="p">))</span>
<a id="__codelineno-8-58" name="__codelineno-8-58"></a>
<a id="__codelineno-8-59" name="__codelineno-8-59"></a>    <span class="k">return</span> <span class="n">dataframe</span><span class="o">.</span><span class="n">union_all</span><span class="p">(</span><span class="n">results</span><span class="p">)</span> <span class="k">if</span> <span class="n">dataframe</span> <span class="k">else</span> <span class="n">results</span>
<a id="__codelineno-8-60" name="__codelineno-8-60"></a>
<a id="__codelineno-8-61" name="__codelineno-8-61"></a><span class="k">def</span><span class="w"> </span><span class="nf">exec</span><span class="p">(</span><span class="n">session</span><span class="p">:</span> <span class="n">snowpark</span><span class="o">.</span><span class="n">Session</span><span class="p">,</span> <span class="n">sql</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">snowpark</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<a id="__codelineno-8-62" name="__codelineno-8-62"></a>    <span class="n">results</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">sql</span><span class="p">(</span><span class="n">sql</span><span class="p">)</span>
<a id="__codelineno-8-63" name="__codelineno-8-63"></a>    <span class="n">results</span> <span class="o">=</span> <span class="n">results</span><span class="o">.</span><span class="n">with_column</span><span class="p">(</span><span class="s1">'statement_timestamp'</span><span class="p">,</span> <span class="n">lit</span><span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()))</span>
<a id="__codelineno-8-64" name="__codelineno-8-64"></a>    <span class="n">results</span> <span class="o">=</span> <span class="n">results</span><span class="o">.</span><span class="n">with_column</span><span class="p">(</span><span class="s1">'statement'</span><span class="p">,</span> <span class="n">lit</span><span class="p">(</span><span class="n">sql</span><span class="p">))</span>
<a id="__codelineno-8-65" name="__codelineno-8-65"></a>    <span class="k">return</span> <span class="n">results</span>
<a id="__codelineno-8-66" name="__codelineno-8-66"></a>
<a id="__codelineno-8-67" name="__codelineno-8-67"></a><span class="k">def</span><span class="w"> </span><span class="nf">sync_dropped_tables</span><span class="p">(</span><span class="n">session</span><span class="p">:</span> <span class="n">snowpark</span><span class="o">.</span><span class="n">Session</span><span class="p">,</span> <span class="n">external_catalog_tables</span><span class="p">:</span> <span class="nb">list</span><span class="p">,</span> <span class="n">drop</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<a id="__codelineno-8-68" name="__codelineno-8-68"></a>    <span class="n">all_tables_df</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">sql</span><span class="p">(</span><span class="s2">"""</span>
<a id="__codelineno-8-69" name="__codelineno-8-69"></a><span class="s2">SELECT CONCAT(table_schema, '.', table_name) AS FQTN, table_schema, table_name  FROM INFORMATION_SCHEMA.TABLES WHERE table_catalog = CURRENT_DATABASE() and table_schema NOT IN ('INFORMATION_SCHEMA', 'PUBLIC')</span>
<a id="__codelineno-8-70" name="__codelineno-8-70"></a><span class="s2">"""</span><span class="p">)</span><span class="o">.</span><span class="n">toPandas</span><span class="p">()</span>
<a id="__codelineno-8-71" name="__codelineno-8-71"></a>
<a id="__codelineno-8-72" name="__codelineno-8-72"></a>    <span class="n">external_catalog_tables_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="n">external_catalog_tables</span><span class="p">)</span> 
<a id="__codelineno-8-73" name="__codelineno-8-73"></a>    <span class="n">external_catalog_tables_df</span><span class="p">[</span><span class="s1">'FQTN'</span><span class="p">]</span> <span class="o">=</span> <span class="n">external_catalog_tables_df</span><span class="p">[</span><span class="s2">"namespace"</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">+</span> <span class="s2">"."</span> <span class="o">+</span> <span class="n">external_catalog_tables_df</span><span class="p">[</span><span class="s2">"name"</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>
<a id="__codelineno-8-74" name="__codelineno-8-74"></a>
<a id="__codelineno-8-75" name="__codelineno-8-75"></a>    <span class="n">tables_to_drop</span> <span class="o">=</span> <span class="n">all_tables_df</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">external_catalog_tables_df</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="s1">'FQTN'</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s1">'left'</span><span class="p">,</span> <span class="n">indicator</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-8-76" name="__codelineno-8-76"></a>    <span class="n">tables_to_drop</span> <span class="o">=</span> <span class="n">tables_to_drop</span><span class="p">[</span><span class="n">tables_to_drop</span><span class="p">[</span><span class="s1">'_merge'</span><span class="p">]</span> <span class="o">==</span> <span class="s1">'left_only'</span><span class="p">]</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">'_merge'</span><span class="p">])</span>
<a id="__codelineno-8-77" name="__codelineno-8-77"></a>    <span class="n">drop_statements</span> <span class="o">=</span> <span class="n">tables_to_drop</span><span class="p">[</span><span class="s2">"FQTN"</span><span class="p">]</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">fqtn</span><span class="p">:</span> <span class="sa">f</span><span class="s2">"""DROP TABLE </span><span class="si">{</span><span class="n">fqtn</span><span class="si">}</span><span class="s2">"""</span><span class="p">)</span>
<a id="__codelineno-8-78" name="__codelineno-8-78"></a>
<a id="__codelineno-8-79" name="__codelineno-8-79"></a>    <span class="k">for</span> <span class="n">sql</span> <span class="ow">in</span> <span class="n">drop_statements</span><span class="p">:</span>
<a id="__codelineno-8-80" name="__codelineno-8-80"></a>        <span class="k">if</span> <span class="n">drop</span><span class="p">:</span>
<a id="__codelineno-8-81" name="__codelineno-8-81"></a>            <span class="n">session</span><span class="o">.</span><span class="n">sql</span><span class="p">(</span><span class="n">sql</span><span class="p">)</span>
<a id="__codelineno-8-82" name="__codelineno-8-82"></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Dropped orphan table: </span><span class="si">{</span><span class="n">sql</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
<a id="__codelineno-8-83" name="__codelineno-8-83"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-8-84" name="__codelineno-8-84"></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">"Orphan table detected. Run the following to drop it:"</span><span class="p">)</span>
<a id="__codelineno-8-85" name="__codelineno-8-85"></a>            <span class="nb">print</span><span class="p">(</span><span class="n">sql</span><span class="p">)</span>
</code></pre></div></td></tr></tbody></table></div>
</div>
<div class="tabbed-block">
<div class="highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-9-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-9-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-9-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-9-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-9-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-9-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-9-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-9-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-9-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-9-10">10</a></span>
<span class="normal"><a href="#__codelineno-9-11">11</a></span>
<span class="normal"><a href="#__codelineno-9-12">12</a></span>
<span class="normal"><a href="#__codelineno-9-13">13</a></span>
<span class="normal"><a href="#__codelineno-9-14">14</a></span>
<span class="normal"><a href="#__codelineno-9-15">15</a></span>
<span class="normal"><a href="#__codelineno-9-16">16</a></span>
<span class="normal"><a href="#__codelineno-9-17">17</a></span>
<span class="normal"><a href="#__codelineno-9-18">18</a></span>
<span class="normal"><a href="#__codelineno-9-19">19</a></span>
<span class="normal"><a href="#__codelineno-9-20">20</a></span>
<span class="normal"><a href="#__codelineno-9-21">21</a></span>
<span class="normal"><a href="#__codelineno-9-22">22</a></span>
<span class="normal"><a href="#__codelineno-9-23">23</a></span>
<span class="normal"><a href="#__codelineno-9-24">24</a></span>
<span class="normal"><a href="#__codelineno-9-25">25</a></span>
<span class="normal"><a href="#__codelineno-9-26">26</a></span>
<span class="normal"><a href="#__codelineno-9-27">27</a></span>
<span class="normal"><a href="#__codelineno-9-28">28</a></span>
<span class="normal"><a href="#__codelineno-9-29">29</a></span>
<span class="normal"><a href="#__codelineno-9-30">30</a></span>
<span class="normal"><a href="#__codelineno-9-31">31</a></span>
<span class="normal"><a href="#__codelineno-9-32">32</a></span>
<span class="normal"><a href="#__codelineno-9-33">33</a></span>
<span class="normal"><a href="#__codelineno-9-34">34</a></span>
<span class="normal"><a href="#__codelineno-9-35">35</a></span>
<span class="normal"><a href="#__codelineno-9-36">36</a></span>
<span class="normal"><a href="#__codelineno-9-37">37</a></span>
<span class="normal"><a href="#__codelineno-9-38">38</a></span>
<span class="normal"><a href="#__codelineno-9-39">39</a></span>
<span class="normal"><a href="#__codelineno-9-40">40</a></span>
<span class="normal"><a href="#__codelineno-9-41">41</a></span>
<span class="normal"><a href="#__codelineno-9-42">42</a></span>
<span class="normal"><a href="#__codelineno-9-43">43</a></span>
<span class="normal"><a href="#__codelineno-9-44">44</a></span>
<span class="normal"><a href="#__codelineno-9-45">45</a></span>
<span class="normal"><a href="#__codelineno-9-46">46</a></span>
<span class="normal"><a href="#__codelineno-9-47">47</a></span>
<span class="normal"><a href="#__codelineno-9-48">48</a></span>
<span class="normal"><a href="#__codelineno-9-49">49</a></span>
<span class="normal"><a href="#__codelineno-9-50">50</a></span>
<span class="normal"><a href="#__codelineno-9-51">51</a></span>
<span class="normal"><a href="#__codelineno-9-52">52</a></span>
<span class="normal"><a href="#__codelineno-9-53">53</a></span>
<span class="normal"><a href="#__codelineno-9-54">54</a></span>
<span class="normal"><a href="#__codelineno-9-55">55</a></span>
<span class="normal"><a href="#__codelineno-9-56">56</a></span>
<span class="normal"><a href="#__codelineno-9-57">57</a></span>
<span class="normal"><a href="#__codelineno-9-58">58</a></span>
<span class="normal"><a href="#__codelineno-9-59">59</a></span>
<span class="normal"><a href="#__codelineno-9-60">60</a></span>
<span class="normal"><a href="#__codelineno-9-61">61</a></span>
<span class="normal"><a href="#__codelineno-9-62">62</a></span>
<span class="normal"><a href="#__codelineno-9-63">63</a></span>
<span class="normal"><a href="#__codelineno-9-64">64</a></span>
<span class="normal"><a href="#__codelineno-9-65">65</a></span>
<span class="normal"><a href="#__codelineno-9-66">66</a></span>
<span class="normal"><a href="#__codelineno-9-67">67</a></span>
<span class="normal"><a href="#__codelineno-9-68">68</a></span>
<span class="normal"><a href="#__codelineno-9-69">69</a></span>
<span class="normal"><a href="#__codelineno-9-70">70</a></span>
<span class="normal"><a href="#__codelineno-9-71">71</a></span>
<span class="normal"><a href="#__codelineno-9-72">72</a></span>
<span class="normal"><a href="#__codelineno-9-73">73</a></span>
<span class="normal"><a href="#__codelineno-9-74">74</a></span>
<span class="normal"><a href="#__codelineno-9-75">75</a></span>
<span class="normal"><a href="#__codelineno-9-76">76</a></span>
<span class="normal"><a href="#__codelineno-9-77">77</a></span>
<span class="normal"><a href="#__codelineno-9-78">78</a></span>
<span class="normal"><a href="#__codelineno-9-79">79</a></span>
<span class="normal"><a href="#__codelineno-9-80">80</a></span>
<span class="normal"><a href="#__codelineno-9-81">81</a></span>
<span class="normal"><a href="#__codelineno-9-82">82</a></span>
<span class="normal"><a href="#__codelineno-9-83">83</a></span>
<span class="normal"><a href="#__codelineno-9-84">84</a></span>
<span class="normal"><a href="#__codelineno-9-85">85</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-9-1" name="__codelineno-9-1"></a><span class="kn">import</span><span class="w"> </span><span class="nn">snowflake.snowpark</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">snowpark</span>
<a id="__codelineno-9-2" name="__codelineno-9-2"></a><span class="kn">from</span><span class="w"> </span><span class="nn">snowflake.snowpark.functions</span><span class="w"> </span><span class="kn">import</span> <span class="n">col</span><span class="p">,</span> <span class="n">lit</span>
<a id="__codelineno-9-3" name="__codelineno-9-3"></a><span class="kn">import</span><span class="w"> </span><span class="nn">json</span>
<a id="__codelineno-9-4" name="__codelineno-9-4"></a><span class="kn">import</span><span class="w"> </span><span class="nn">datetime</span>
<a id="__codelineno-9-5" name="__codelineno-9-5"></a><span class="kn">import</span><span class="w"> </span><span class="nn">pandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pd</span>
<a id="__codelineno-9-6" name="__codelineno-9-6"></a><span class="kn">from</span><span class="w"> </span><span class="nn">functools</span><span class="w"> </span><span class="kn">import</span> <span class="n">reduce</span>
<a id="__codelineno-9-7" name="__codelineno-9-7"></a>
<a id="__codelineno-9-8" name="__codelineno-9-8"></a><span class="n">CATALOG_INTEGRATION_NAME</span> <span class="o">=</span> <span class="s1">'fivetran_catalog_throwback_refinery'</span>
<a id="__codelineno-9-9" name="__codelineno-9-9"></a><span class="n">EXTERNAL_VOLUME_NAME</span>     <span class="o">=</span> <span class="s1">'fivetran_volume_throwback_refinery'</span>
<a id="__codelineno-9-10" name="__codelineno-9-10"></a>
<a id="__codelineno-9-11" name="__codelineno-9-11"></a><span class="k">def</span><span class="w"> </span><span class="nf">main</span><span class="p">(</span><span class="n">session</span><span class="p">:</span> <span class="n">snowpark</span><span class="o">.</span><span class="n">Session</span><span class="p">):</span>
<a id="__codelineno-9-12" name="__codelineno-9-12"></a>    <span class="c1"># Fetch a list of tables from the external catalog</span>
<a id="__codelineno-9-13" name="__codelineno-9-13"></a>    <span class="n">external_catalog_tables</span> <span class="o">=</span> <span class="p">[</span>
<a id="__codelineno-9-14" name="__codelineno-9-14"></a>        <span class="n">row</span>
<a id="__codelineno-9-15" name="__codelineno-9-15"></a>        <span class="k">for</span> <span class="n">rs</span> <span class="ow">in</span> <span class="n">session</span><span class="o">.</span><span class="n">sql</span><span class="p">(</span><span class="sa">f</span><span class="s2">"select SYSTEM$LIST_ICEBERG_TABLES_FROM_CATALOG('</span><span class="si">{</span><span class="n">CATALOG_INTEGRATION_NAME</span><span class="si">}</span><span class="s2">','',0) as TABLE_LIST"</span><span class="p">)</span><span class="o">.</span><span class="n">collect</span><span class="p">()</span>
<a id="__codelineno-9-16" name="__codelineno-9-16"></a>        <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">rs</span><span class="o">.</span><span class="n">as_dict</span><span class="p">()[</span><span class="s2">"TABLE_LIST"</span><span class="p">])</span>
<a id="__codelineno-9-17" name="__codelineno-9-17"></a>    <span class="p">]</span>
<a id="__codelineno-9-18" name="__codelineno-9-18"></a>
<a id="__codelineno-9-19" name="__codelineno-9-19"></a>    <span class="c1"># Convert the tables to the appropriate CREATE SCHEMA and CREATE ICEBERG TABLE statements</span>
<a id="__codelineno-9-20" name="__codelineno-9-20"></a>    <span class="n">statements</span> <span class="o">=</span> <span class="p">[</span>
<a id="__codelineno-9-21" name="__codelineno-9-21"></a>        <span class="n">sql</span>
<a id="__codelineno-9-22" name="__codelineno-9-22"></a>        <span class="k">for</span> <span class="n">table</span> <span class="ow">in</span> <span class="n">external_catalog_tables</span>
<a id="__codelineno-9-23" name="__codelineno-9-23"></a>        <span class="k">for</span> <span class="n">sql</span> <span class="ow">in</span> <span class="p">[</span><span class="n">create_schema</span><span class="p">(</span><span class="n">table</span><span class="p">),</span> <span class="n">create_table</span><span class="p">(</span><span class="n">table</span><span class="p">)]</span>
<a id="__codelineno-9-24" name="__codelineno-9-24"></a>    <span class="p">]</span>
<a id="__codelineno-9-25" name="__codelineno-9-25"></a>
<a id="__codelineno-9-26" name="__codelineno-9-26"></a>    <span class="c1"># Execute each of the statements and merge the resulting dataframes into one combined dataframe to show the user</span>
<a id="__codelineno-9-27" name="__codelineno-9-27"></a>    <span class="n">results</span> <span class="o">=</span> <span class="n">reduce</span><span class="p">(</span><span class="k">lambda</span> <span class="n">left</span><span class="p">,</span> <span class="n">right</span><span class="p">:</span> <span class="n">left</span><span class="o">.</span><span class="n">union_all</span><span class="p">(</span><span class="n">right</span><span class="p">),</span> <span class="p">[</span>
<a id="__codelineno-9-28" name="__codelineno-9-28"></a>        <span class="n">exec</span><span class="p">(</span><span class="n">session</span><span class="p">,</span> <span class="n">statement</span><span class="p">)</span>
<a id="__codelineno-9-29" name="__codelineno-9-29"></a>        <span class="k">for</span> <span class="n">statement</span> <span class="ow">in</span> <span class="n">statements</span>
<a id="__codelineno-9-30" name="__codelineno-9-30"></a>    <span class="p">])</span>
<a id="__codelineno-9-31" name="__codelineno-9-31"></a>
<a id="__codelineno-9-32" name="__codelineno-9-32"></a>    <span class="c1"># Identify any tables that exist in CURRENT_DATABASE() that are not tracked in the external catalog and optionally</span>
<a id="__codelineno-9-33" name="__codelineno-9-33"></a>    <span class="n">sync_dropped_tables</span><span class="p">(</span><span class="n">session</span><span class="p">,</span> <span class="n">external_catalog_tables</span><span class="p">,</span> <span class="n">drop</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<a id="__codelineno-9-34" name="__codelineno-9-34"></a>
<a id="__codelineno-9-35" name="__codelineno-9-35"></a>    <span class="k">return</span> <span class="n">results</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">col</span><span class="p">(</span><span class="s1">'statement_timestamp'</span><span class="p">))</span>
<a id="__codelineno-9-36" name="__codelineno-9-36"></a>
<a id="__codelineno-9-37" name="__codelineno-9-37"></a><span class="k">def</span><span class="w"> </span><span class="nf">create_schema</span><span class="p">(</span><span class="n">table</span><span class="p">):</span>
<a id="__codelineno-9-38" name="__codelineno-9-38"></a>    <span class="k">return</span> <span class="sa">f</span><span class="s2">"""</span>
<a id="__codelineno-9-39" name="__codelineno-9-39"></a><span class="s2">CREATE SCHEMA if not exists </span><span class="si">{</span><span class="n">table</span><span class="p">[</span><span class="s1">'namespace'</span><span class="p">]</span><span class="si">}</span>
<a id="__codelineno-9-40" name="__codelineno-9-40"></a><span class="s2">EXTERNAL_VOLUME = '</span><span class="si">{</span><span class="n">EXTERNAL_VOLUME_NAME</span><span class="si">}</span><span class="s2">'</span>
<a id="__codelineno-9-41" name="__codelineno-9-41"></a><span class="s2">CATALOG='</span><span class="si">{</span><span class="n">CATALOG_INTEGRATION_NAME</span><span class="si">}</span><span class="s2">'</span>
<a id="__codelineno-9-42" name="__codelineno-9-42"></a><span class="s2">"""</span>
<a id="__codelineno-9-43" name="__codelineno-9-43"></a>
<a id="__codelineno-9-44" name="__codelineno-9-44"></a><span class="k">def</span><span class="w"> </span><span class="nf">create_table</span><span class="p">(</span><span class="n">table</span><span class="p">):</span>
<a id="__codelineno-9-45" name="__codelineno-9-45"></a>    <span class="k">return</span> <span class="sa">f</span><span class="s2">"""</span>
<a id="__codelineno-9-46" name="__codelineno-9-46"></a><span class="s2">CREATE OR REPLACE ICEBERG TABLE </span><span class="si">{</span><span class="n">table</span><span class="p">[</span><span class="s1">'namespace'</span><span class="p">]</span><span class="si">}</span><span class="s2">.</span><span class="si">{</span><span class="n">table</span><span class="p">[</span><span class="s1">'name'</span><span class="p">]</span><span class="si">}</span>
<a id="__codelineno-9-47" name="__codelineno-9-47"></a><span class="s2">EXTERNAL_VOLUME = '</span><span class="si">{</span><span class="n">EXTERNAL_VOLUME_NAME</span><span class="si">}</span><span class="s2">'</span>
<a id="__codelineno-9-48" name="__codelineno-9-48"></a><span class="s2">CATALOG='</span><span class="si">{</span><span class="n">CATALOG_INTEGRATION_NAME</span><span class="si">}</span><span class="s2">'</span>
<a id="__codelineno-9-49" name="__codelineno-9-49"></a><span class="s2">CATALOG_NAMESPACE= '</span><span class="si">{</span><span class="n">table</span><span class="p">[</span><span class="s1">'namespace'</span><span class="p">]</span><span class="si">}</span><span class="s2">'</span>
<a id="__codelineno-9-50" name="__codelineno-9-50"></a><span class="s2">CATALOG_TABLE_NAME = '</span><span class="si">{</span><span class="n">table</span><span class="p">[</span><span class="s1">'name'</span><span class="p">]</span><span class="si">}</span><span class="s2">'</span>
<a id="__codelineno-9-51" name="__codelineno-9-51"></a><span class="s2">AUTO_REFRESH=TRUE;</span>
<a id="__codelineno-9-52" name="__codelineno-9-52"></a><span class="s2">"""</span>
<a id="__codelineno-9-53" name="__codelineno-9-53"></a>
<a id="__codelineno-9-54" name="__codelineno-9-54"></a><span class="k">def</span><span class="w"> </span><span class="nf">exec_and_aggregate_results</span><span class="p">(</span><span class="n">session</span><span class="p">:</span> <span class="n">snowpark</span><span class="o">.</span><span class="n">Session</span><span class="p">,</span> <span class="n">dataframe</span><span class="p">:</span> <span class="n">snowpark</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">sql</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">snowpark</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<a id="__codelineno-9-55" name="__codelineno-9-55"></a>    <span class="n">results</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">sql</span><span class="p">(</span><span class="n">sql</span><span class="p">)</span>
<a id="__codelineno-9-56" name="__codelineno-9-56"></a>    <span class="n">results</span> <span class="o">=</span> <span class="n">results</span><span class="o">.</span><span class="n">with_column</span><span class="p">(</span><span class="s1">'statement_timestamp'</span><span class="p">,</span> <span class="n">lit</span><span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()))</span>
<a id="__codelineno-9-57" name="__codelineno-9-57"></a>    <span class="n">results</span> <span class="o">=</span> <span class="n">results</span><span class="o">.</span><span class="n">with_column</span><span class="p">(</span><span class="s1">'statement'</span><span class="p">,</span> <span class="n">lit</span><span class="p">(</span><span class="n">sql</span><span class="p">))</span>
<a id="__codelineno-9-58" name="__codelineno-9-58"></a>
<a id="__codelineno-9-59" name="__codelineno-9-59"></a>    <span class="k">return</span> <span class="n">dataframe</span><span class="o">.</span><span class="n">union_all</span><span class="p">(</span><span class="n">results</span><span class="p">)</span> <span class="k">if</span> <span class="n">dataframe</span> <span class="k">else</span> <span class="n">results</span>
<a id="__codelineno-9-60" name="__codelineno-9-60"></a>
<a id="__codelineno-9-61" name="__codelineno-9-61"></a><span class="k">def</span><span class="w"> </span><span class="nf">exec</span><span class="p">(</span><span class="n">session</span><span class="p">:</span> <span class="n">snowpark</span><span class="o">.</span><span class="n">Session</span><span class="p">,</span> <span class="n">sql</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">snowpark</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<a id="__codelineno-9-62" name="__codelineno-9-62"></a>    <span class="n">results</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">sql</span><span class="p">(</span><span class="n">sql</span><span class="p">)</span>
<a id="__codelineno-9-63" name="__codelineno-9-63"></a>    <span class="n">results</span> <span class="o">=</span> <span class="n">results</span><span class="o">.</span><span class="n">with_column</span><span class="p">(</span><span class="s1">'statement_timestamp'</span><span class="p">,</span> <span class="n">lit</span><span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()))</span>
<a id="__codelineno-9-64" name="__codelineno-9-64"></a>    <span class="n">results</span> <span class="o">=</span> <span class="n">results</span><span class="o">.</span><span class="n">with_column</span><span class="p">(</span><span class="s1">'statement'</span><span class="p">,</span> <span class="n">lit</span><span class="p">(</span><span class="n">sql</span><span class="p">))</span>
<a id="__codelineno-9-65" name="__codelineno-9-65"></a>    <span class="k">return</span> <span class="n">results</span>
<a id="__codelineno-9-66" name="__codelineno-9-66"></a>
<a id="__codelineno-9-67" name="__codelineno-9-67"></a><span class="k">def</span><span class="w"> </span><span class="nf">sync_dropped_tables</span><span class="p">(</span><span class="n">session</span><span class="p">:</span> <span class="n">snowpark</span><span class="o">.</span><span class="n">Session</span><span class="p">,</span> <span class="n">external_catalog_tables</span><span class="p">:</span> <span class="nb">list</span><span class="p">,</span> <span class="n">drop</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<a id="__codelineno-9-68" name="__codelineno-9-68"></a>    <span class="n">all_tables_df</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">sql</span><span class="p">(</span><span class="s2">"""</span>
<a id="__codelineno-9-69" name="__codelineno-9-69"></a><span class="s2">SELECT CONCAT(table_schema, '.', table_name) AS FQTN, table_schema, table_name  FROM INFORMATION_SCHEMA.TABLES WHERE table_catalog = CURRENT_DATABASE() and table_schema NOT IN ('INFORMATION_SCHEMA', 'PUBLIC')</span>
<a id="__codelineno-9-70" name="__codelineno-9-70"></a><span class="s2">"""</span><span class="p">)</span><span class="o">.</span><span class="n">toPandas</span><span class="p">()</span>
<a id="__codelineno-9-71" name="__codelineno-9-71"></a>
<a id="__codelineno-9-72" name="__codelineno-9-72"></a>    <span class="n">external_catalog_tables_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="n">external_catalog_tables</span><span class="p">)</span> 
<a id="__codelineno-9-73" name="__codelineno-9-73"></a>    <span class="n">external_catalog_tables_df</span><span class="p">[</span><span class="s1">'FQTN'</span><span class="p">]</span> <span class="o">=</span> <span class="n">external_catalog_tables_df</span><span class="p">[</span><span class="s2">"namespace"</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">+</span> <span class="s2">"."</span> <span class="o">+</span> <span class="n">external_catalog_tables_df</span><span class="p">[</span><span class="s2">"name"</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>
<a id="__codelineno-9-74" name="__codelineno-9-74"></a>
<a id="__codelineno-9-75" name="__codelineno-9-75"></a>    <span class="n">tables_to_drop</span> <span class="o">=</span> <span class="n">all_tables_df</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">external_catalog_tables_df</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="s1">'FQTN'</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s1">'left'</span><span class="p">,</span> <span class="n">indicator</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-9-76" name="__codelineno-9-76"></a>    <span class="n">tables_to_drop</span> <span class="o">=</span> <span class="n">tables_to_drop</span><span class="p">[</span><span class="n">tables_to_drop</span><span class="p">[</span><span class="s1">'_merge'</span><span class="p">]</span> <span class="o">==</span> <span class="s1">'left_only'</span><span class="p">]</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">'_merge'</span><span class="p">])</span>
<a id="__codelineno-9-77" name="__codelineno-9-77"></a>    <span class="n">drop_statements</span> <span class="o">=</span> <span class="n">tables_to_drop</span><span class="p">[</span><span class="s2">"FQTN"</span><span class="p">]</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">fqtn</span><span class="p">:</span> <span class="sa">f</span><span class="s2">"""DROP TABLE </span><span class="si">{</span><span class="n">fqtn</span><span class="si">}</span><span class="s2">"""</span><span class="p">)</span>
<a id="__codelineno-9-78" name="__codelineno-9-78"></a>
<a id="__codelineno-9-79" name="__codelineno-9-79"></a>    <span class="k">for</span> <span class="n">sql</span> <span class="ow">in</span> <span class="n">drop_statements</span><span class="p">:</span>
<a id="__codelineno-9-80" name="__codelineno-9-80"></a>        <span class="k">if</span> <span class="n">drop</span><span class="p">:</span>
<a id="__codelineno-9-81" name="__codelineno-9-81"></a>            <span class="n">session</span><span class="o">.</span><span class="n">sql</span><span class="p">(</span><span class="n">sql</span><span class="p">)</span>
<a id="__codelineno-9-82" name="__codelineno-9-82"></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Dropped orphan table: </span><span class="si">{</span><span class="n">sql</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
<a id="__codelineno-9-83" name="__codelineno-9-83"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-9-84" name="__codelineno-9-84"></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">"Orphan table detected. Run the following to drop it:"</span><span class="p">)</span>
<a id="__codelineno-9-85" name="__codelineno-9-85"></a>            <span class="nb">print</span><span class="p">(</span><span class="n">sql</span><span class="p">)</span>
</code></pre></div></td></tr></tbody></table></div>
</div>
<div class="tabbed-block">
<table>
<thead>
<tr>
<th>status</th>
<th>STATEMENT_TIMESTAMP</th>
<th>STATEMENT</th>
</tr>
</thead>
<tbody>
<tr>
<td>Schema GOOGLE_ANALYTICS successfully created.</td>
<td>2025-05-23 14:28:14.514</td>
<td>CREATE SCHEMA if not exists google_analytics EXTERNAL_VOLUME = 'fivetran_volume_buffer_concierge' CATALOG='fivetran_catalog_buffer_concierge'</td>
</tr>
<tr>
<td>Table CONVERSION_EVENTS successfully created.</td>
<td>2025-05-23 14:28:14.517</td>
<td>CREATE OR REPLACE ICEBERG TABLE google_analytics.conversion_events EXTERNAL_VOLUME = 'fivetran_volume_buffer_concierge' CATALOG='fivetran_catalog_buffer_concierge' CATALOG_NAMESPACE= 'google_analytics' CATALOG_TABLE_NAME = 'conversion_events' AUTO_REFRESH=TRUE;</td>
</tr>
<tr>
<td>GOOGLE_ANALYTICS already exists, statement succeeded.</td>
<td>2025-05-23 14:28:14.520</td>
<td>CREATE SCHEMA if not exists google_analytics EXTERNAL_VOLUME = 'fivetran_volume_buffer_concierge' CATALOG='fivetran_catalog_buffer_concierge'</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>









  




                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs Insiders
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      
      <script id="__config" type="application/json">{"annotate": null, "base": "../../..", "features": ["content.code.select", "content.code.copy", "content.action.edit", "content.action.view", "content.code.annotate"], "search": "../../../assets/javascripts/workers/search.26099bd0.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../../../assets/javascripts/bundle.9d1edc04.min.js"></script>
      
    
  
<script id="init-glightbox">const lightbox = GLightbox({"touchNavigation": true, "loop": false, "zoomable": true, "draggable": true, "openEffect": "zoom", "closeEffect": "zoom", "slideEffect": "slide"});
document$.subscribe(()=>{ lightbox.reload(); });
</script></body></html>